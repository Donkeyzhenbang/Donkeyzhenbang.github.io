<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.3.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Mist","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":false,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}}};
  </script>

  <meta property="og:type" content="website">
<meta property="og:title" content="凌云苑">
<meta property="og:url" content="http://example.com/index.html">
<meta property="og:site_name" content="凌云苑">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="ADonkey">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>凌云苑</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">凌云苑</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
  </ul>
</nav>




</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/05/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/11/05/Linux%E9%AB%98%E6%80%A7%E8%83%BD%E6%9C%8D%E5%8A%A1%E5%99%A8%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">Linux高性能服务器编程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-11-05 08:00:00 / 修改时间：00:00:00" itemprop="dateCreated datePublished" datetime="2024-11-05T08:00:00+08:00">2024-11-05</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BD%91%E7%BB%9C/" itemprop="url" rel="index"><span itemprop="name">计算机网络</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>6.7k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>6 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Linux高性能服务器编程"><a href="#Linux高性能服务器编程" class="headerlink" title="Linux高性能服务器编程"></a>Linux高性能服务器编程</h2><h3 id="第一篇-TCP-IP协议族"><a href="#第一篇-TCP-IP协议族" class="headerlink" title="第一篇 TCP&#x2F;IP协议族"></a>第一篇 TCP&#x2F;IP协议族</h3><h4 id="第一章-TCP-IP协议族"><a href="#第一章-TCP-IP协议族" class="headerlink" title="第一章 TCP&#x2F;IP协议族"></a>第一章 TCP&#x2F;IP协议族</h4><h5 id="TCP-IP协议族体系结构及主要协议"><a href="#TCP-IP协议族体系结构及主要协议" class="headerlink" title="TCP&#x2F;IP协议族体系结构及主要协议"></a>TCP&#x2F;IP协议族体系结构及主要协议</h5><p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105093533877.png" alt="image-20241105093533877"></p>
<p><strong>数据链路层</strong><br>    1.<strong>数据链路层实现了网卡接口的网络驱动程序，以处理数据在物理媒介（比如以太网、令牌环等）上的传输。不同的物理网络具有不同的电气特性，网络驱动程序隐藏了这些细节，为上层协议提供一个统一的接口。</strong><br>    2.数<strong>据链路层两个常用的协议是ARP协议（Address Resolve Protocol，地址解析协议）和RARP协议（Reverse Address Resolve Protocol，逆地址解析协议）。它们实现了IP地址和机器物理地址（通常是MAC地址，以太网、令牌环和802.11无线网络都使用MAC地址）之间的相互转换。</strong><br>    3.网<strong>络层使用IP地址寻址一台机器，而数据链路层使用物理地址寻址一台机器，因此网络层必须先将目标机器的IP地址转化成其物理地址，才能使用数据链路层提供的服务，这就是ARP协议的用途。</strong>RARP协议仅用于网络上的某些无盘工作站。因为缺乏存储设备，无盘工作站无法记住自己的IP地址，但它们可以利用网卡上的物理地址来向网络管理者（服务器或网络管理软件）查询自身的IP地址。运行RARP服务的网络管理者通常存有该网络上所有机器的物理地址到IP地址的映射  </p>
<p><strong>网络层</strong><br>    1.网<strong>络层实现数据包的选路和转发</strong>。WAN（Wide Area Network，广域网）通常使用众多分级的路由器来连接分散的主机或LAN（Local Area Network，局域网），因此，通信的两台主机一般不是直接相连的，而是通过多个中间节点（路由器）连接的。网络层的任务就是选择这些中间节点，以确定两台主机之间的通信路径。同时，网络层对上层协议隐藏了网络拓扑连接的细节，使得在传输层和网络应用程序看来，通信的双方是直接相连的。<br>    2.<strong>网络层最核心的协议是IP协议（Internet Protocol，因特网协议）。IP协议根据数据包的目的IP地址来决定如何投递它。如果数据包不能直接发送给目标主机，那么IP协议就为它寻找一个合适的下一跳（next hop）路由器，并将数据包交付给该路由器来转发。多次重复这一过程，数据包最终到达目标主机，或者由于发送失败而被丢弃。可见， IP协议使用逐跳（hop by hop）的方式确定通信路径。</strong>我们将在第2章详细讨论IP协议。<br>    3.网络层另外一个重要的协议是ICMP协议（Internet Control Message Protocol，因特网控制报文协议）。它是IP协议的重要补充，主要用于<strong>检测网络连接</strong>。  8位类型字段用于区分报文类型。它将ICMP报文分为两大类：一类是差错报文，这类报文主要用来回应网络错误，比如目标不可到达（类型值为3）和重定向（类型值为5）；另一类是查询报文，这类报文用来查询网络信息，比如ping程序就是使用ICMP报文查看目标是否可到达（类型值为8）的。有的ICMP报文还使用8位代码字段来进一步细分不同的条件。比如重定向报文使用代码值0表示对网络重定向，代码值1表示对主机重定向。ICMP报文使用16位校验和字段对整个报文（包括头部和内容部分）进行循环冗余校验（Cyclic Redundancy Check，CRC），以检验报文在传输过程中是否损坏。不同的ICMP报文类型具有不同的正文内容。我们将在第2章详细讨论主机重定向报文，其他ICMP报文格式请参考ICMP协议的标准文档RFC 792。<br>    4.ICMP协议并非严格意义上的网络层协议，因为它使用处于同一层的IP协议提供的服务（一般来说，上层协议使用下层协议提供的服务）。  </p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105100006449.png" alt="image-20241105100006449"></p>
<p><strong>传输层</strong><br>    1.ICMP协议并非严格意义上的网络层协议，因为它使用处于同一层的IP协议提供的服务（一般来说，上层协议使用下层协议提供的服务）。<br>    2.垂直的实线箭头表示TCP&#x2F;IP协议族各层之间的实体通信（数据包确实是沿着这些线路传递的），而水平的虚线箭头表示逻辑通信线路。该图中还附带描述了不同物理网络的连接方法。可见，<strong>数据链路层（驱动程序）封装了物理网络的电气细节；网络层封装了网络连接的细节；传输层则为应用程序封装了一条端到端的逻辑通信链路，它负责数据的收发、链路的超时重连等。传输层协议主要有三个：TCP协议、UDP协议和SCTP协议。</strong><br>    3.<strong>TCP协议（Transmission Control Protocol，传输控制协议）为应用层提供可靠的、面向连接的和基于流（stream）的服务。</strong>TCP协议使用<strong>超时重传、数据确认</strong>等方式来确保数据包被正确地发送至目的端，因此TCP服务是可靠的。使用TCP协议通信的双方必须先建立TCP连接，并在内核中为该连接维持一些必要的数据结构，比如连接的状态、读写缓冲区，以及诸多定时器等。当通信结束时，双方必须关闭连接以释放这些内核数据。<strong>TCP服务是基于流的。基于流的数据没有边界（长度）限制，它源源不断地从通信的一端流入另一端。发送端可以逐个字节地向数据流中写入数据，接收端也可以逐个字节地将它们读出。</strong><br>    4.<strong>UDP协议（User Datagram Protocol，用户数据报协议）</strong>则与TCP协议完全相反，它为应用层提供<strong>不可靠、无连接和基于数据报</strong>的服务。“不可靠”意味着UDP协议无法保证数据从发送端正确地传送到目的端。如果数据在中途丢失，或者目的端通过数据校验发现数据错误而将其丢弃，则UDP协议只是简单地通知应用程序发送失败。因此，<strong>使用UDP协议的应用程序通常要自己处理数据确认、超时重传等逻辑。UDP协议是无连接的，即通信双方不保持一个长久的联系，因此应用程序每次发送数据都要明确指定接收端的地址（IP地址等信息）。基于数据报的服务，是相对基于流的服务而言的。每个UDP数据报都有一个长度，接收端必须以该长度为最小单位将其所有内容一次性读出，否则数据将被截断。</strong>  </p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105100540693.png" alt="image-20241105100540693"></p>
<p><strong>应用层</strong><br>    1.应用层负责处理应用程序的逻辑。数据链路层、网络层和传输层负责处理网络通信细节，这部分必须既稳定又高效，因此它们都在内核空间中实现，如图1-1所示。而应用层则在用户空间实现，因为它负责处理众多逻辑，比如文件传输、名称查询和网络管理等。如果应用层也在内核中实现，则会使内核变得非常庞大。当然，也有少数服务器程序是在内核中实现的，这样代码就无须在用户空间和内核空间来回切换（主要是数据的复制），极大地提高了工作效率。不过这种代码实现起来较复杂，不够灵活，且不便于移植。<br>    2.ping是应用程序，而不是协议，前面说过它利用ICMP报文检测网络连接，是调试网络环境的必备工具。<br>    3.telnet协议是一种远程登录协议，它使我们能在本地完成远程任务，本书后续章节将会多次使用telnet客户端登录到其他服务上。<br>    4.OSPF（Open Shortest Path First，开放最短路径优先）协议是一种动态路由更新协议，用于路由器之间的通信，以告知对方各自的路由信息。<br>    5.DNS（Domain Name Service，域名服务）协议提供机器域名到IP地址的转换，我们将在后面简要介绍DNS协议。<br>    6.应用层协议（或程序）可能跳过传输层直接使用网络层提供的服务，比如ping程序和OSPF协议。应用层协议（或程序）通常既可以使用TCP服务，又可以使用UDP服务，比如DNS协议。我们可以通过&#x2F;etc&#x2F;services文件查看所有知名的应用层协议，以及它们都能使用哪些传输层服务。</p>
<h5 id="封装"><a href="#封装" class="headerlink" title="封装"></a>封装</h5><p>​	1.上层协议是如何使用下层协议提供的服务的呢？其实这是通过封装（encapsulation）实现的。应用程序数据在发送到物理网络上之前，将沿着协议栈从上往下依次传递。每层协议都将在上层数据的基础上加上自己的头部信息（有时还包括尾部信息），以实现该层的功能，这个过程就称为封装.  </p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105102104036.png" alt="image-20241105102104036"></p>
<p>​	2.经过TCP封装后的数据称为TCP报文段（TCP message segment），或者简称TCP段。前文提到，TCP协议为通信双方维持一个连接，并且在内核中存储相关数据。这部分数据中的TCP头部信息和TCP内核缓冲区（发送缓冲区或接收缓冲区）数据一起构成了TCP报文段，如图1-5中的虚线框所示。</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105102116094.png" alt="image-20241105102116094"></p>
<p>​	3.当发送端应用程序使用send（或者write）函数向一个TCP连接写入数据时，内核中的TCP模块首先把这些数据复制到与该连接对应的TCP内核发送缓冲区中，然后TCP模块调用IP模块提供的服务，传递的参数包括TCP头部信息和TCP发送缓冲区中的数据，即TCP报文段。关于TCP报文段头部的细节，我们将在第3章讨论。<br>​	4.<strong>经过UDP封装后的数据称为UDP数据报（UDP datagram）</strong>。<strong>UDP对应用程序数据的封装与TCP类似。不同的是，UDP无须为应用层数据保存副本，因为它提供的服务是不可靠的。当一个UDP数据报被成功发送之后，UDP内核缓冲区中的该数据报就被丢弃了。如果应用程序检测到该数据报未能被接收端正确接收，并打算重发这个数据报，则应用程序需要重新从用户空间将该数据报拷贝到UDP内核发送缓冲区中。</strong><br>​	5.<strong>经过IP封装后的数据称为IP数据报（IP datagram）</strong>。<strong>IP数据报也包括头部信息和数据部分，其中数据部分就是一个TCP报文段、UDP数据报或者ICMP报文。</strong>我们将在第2章详细讨论IP数据报的头部信息。<br>​	6.<strong>经过数据链路层封装的数据称为帧（frame）</strong>。传输媒介不同，帧的类型也不同。比如，以太网上传输的是以太网帧（ethernet frame），而令牌环网络上传输的则是令牌环帧（token ring frame）。以以太网帧为例，其封装格式如图1-6所示。</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105160508502.png" alt="image-20241105160508502"></p>
<p>​	7.以太网帧使用6字节的目的物理地址和6字节的源物理地址来表示通信的双方。关于类型（type）字段，我们将在后面讨论。4字节CRC字段对帧的其他部分提供循环冗余校验。<strong>帧的最大传输单元（Max Transmit Unit，MTU），即帧最多能携带多少上层协议数据（比如IP数据报），通常受到网络类型的限制</strong>。图1-6所示的以太网帧的MTU是1500字节。正因为如此，过长的IP数据报可能需要被分片（fragment）传输。<strong>帧才是最终在物理网络上传送的字节序列</strong>。至此，封装过程完成。</p>
<h5 id="分用"><a href="#分用" class="headerlink" title="分用"></a>分用</h5><p>1.当帧到达目的主机时，将沿着协议栈自底向上依次传递。各层协议依次处理帧中本层负责的头部数据，以获取所需的信息，并最终将处理后的帧交给目标应用程序。这个过程称为分用（demultiplexing）。分用是依靠头部信息中的类型字段实现的。标准文档RFC 1700定义了所有标识上层协议的类型字段以及每个上层协议对应的数值。图1-7显示了以太网帧的分用过程。  </p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105160651493.png" alt="image-20241105160651493"></p>
<p>​	2.因为IP协议、ARP协议和RARP协议都使用帧传输数据，所以帧的头部需要提供某个字段（具体情况取决于帧的类型）来区分它们。以以太网帧为例，它使用2字节的类型字段来标识上层协议（见图1-6）。如果主机接收到的以太网帧类型字段的值为0x800，则帧的数据部分为IP数据报（见图1-4），以太网驱动程序就将帧交付给IP模块；若类型字段的值为0x806，则帧的数据部分为ARP请求或应答报文，以太网驱动程序就将帧交付给ARP模块；若类型字段的值为0x835，则帧的数据部分为RARP请求或应答报文，以太网驱动程序就将帧交付给RARP模块。<br>​	3.同样，因为ICMP协议、TCP协议和UDP协议都使用IP协议，所以IP数据报的头部采用16位的协议（protocol）字段来区分它们。<br>​	4.TCP报文段和UDP数据报则通过其头部中的16位的端口号（port number）字段来区分上层应用程序。比如DNS协议对应的端口号是53，HTTP协议（Hyper-Text Transfer Protocol，超文本传送协议）对应的端口号是80。所有知名应用层协议使用的端口号都可在&#x2F;etc&#x2F;services文件中找到。<br>​	5.帧通过上述分用步骤后，最终将封装前的原始数据送至目标服务（图1-7中的ARP服务、RARP服务、ICMP服务或者应用程序）。这样，在顶层目标服务看来，封装和分用似乎没有发生过。</p>
<h5 id="测试网络"><a href="#测试网络" class="headerlink" title="测试网络"></a>测试网络</h5><p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105113238137.png" alt="image-20241105113238137"></p>
<p>​	1.该测试网络主要用于分析ARP协议、IP协议、ICMP协议、TCP协议和DNS协议。我们通过抓取该网络上的以太网帧，查看其中的以太网帧头部、IP数据报头部、TCP报文段头部信息，以获取网络通信的细节。这样，以理论结合实践，我们就清楚TCP&#x2F;IP通信具体是如何进行的了。作者编写的多个客户端、服务器程序都是使用该网络来调试和测试的 。<br>​	2.对于路由器，我们仅列出了其LAN网络IP地址（192.168.1.1），而忽略了ISP（Internet Service Provider，因特网服务提供商）给它分配的WAN网络IP地址  </p>
<h5 id="ARP协议工作原理"><a href="#ARP协议工作原理" class="headerlink" title="ARP协议工作原理"></a>ARP协议工作原理</h5><ul>
<li>ARP 协议的 <strong>传输和广播</strong> 发生在数据链路层。</li>
<li><strong>ARP 的调用和需求</strong> 来自网络层，因为 IP 地址到 MAC 地址的映射是网络层通信所需要的。</li>
<li>虽然<strong>数据链路层并不直接“拥有” IP 地址</strong>，但通过操作系统的跨层共享机制，数据链路层的 ARP 模块可以访问本机的 IP 地址，从而实现 IP 地址到 MAC 地址的转换和匹配功能。这种跨层信息共享是为了 ARP 协议的运行需求设计的。</li>
</ul>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105155740681.png" alt="image-20241105155740681"></p>
<p>ARP协议能实现任意网络层地址到任意物理地址的转换，不过本书仅讨论从IP地址到以太网地址（MAC地址）的转换。其工作原理是：主机向自己所在的网络广播一个ARP请求，该请求包含目标机器的网络地址。此网络上的其他机器都将收到这个请求，但只有被请求的目标机器会回应一个ARP应答，其中包含自己的物理地址 。</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105154103140.png" alt="image-20241105154103140"></p>
<p>在网络中数据包传输也是如此，源IP地址和和目标IP地址在传输过程中是不会变化的（前提没有使用NAT网络），只有源MAC地址和目标MAC一直在变化。<br>IP作用时主机之间通信用的，而MAC作用时实现直连的两个设备之间通信，而IP负责在没有直连的两个网络之间进行通信传输。</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105154919133.png" alt="image-20241105154919133"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105154733524.png" alt="image-20241105154733524"></p>
<p><strong>以太网ARP请求&#x2F;应答报文详解</strong>  </p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105153150509.png" alt="image-20241105153150509"></p>
<p>❑硬件类型字段定义物理地址的类型，它的值为1表示MAC地址。❑协议类型字段表示要映射的协议地址类型，它的值为0x800，表示IP地址。<br>❑硬件地址长度字段和协议地址长度字段，顾名思义，其单位是字节。对MAC地址来说，其长度为6；对IP（v4）地址来说，其长度为4。<br>❑操作字段指出4种操作类型：ARP请求（值为1）、ARP应答（值为2）、RARP请求（值为3）和RARP应答（值为4）。<br>❑最后4个字段指定通信双方的以太网地址和IP地址。发送端填充除目的端以太网地址外的其他3个字段，以构建ARP请求并发送之。接收端发现该请求的目的端IP地址是自己，就把自己的以太网地址填进去，然后交换两个目的端地址和两个发送端地址，以构建ARP应答并返回之（当然，如前所述，操作字段需要设置为2）。</p>
<p>由图1-9可知，ARP请求&#x2F;应答报文的长度为28字节。如果再加上以太网帧头部和尾部的18字节（见图1-6），则一个携带ARP请求&#x2F;应答报文的以太网帧长度为46字节。不过有的实现要求以太网帧数据部分长度至少为46字节（见图1-4），此时ARP请求&#x2F;应答报文将增加一些填充字节，以满足这个要求。在这种情况下，一个携带ARP请求&#x2F;应答报文的以太网帧长度为64字节。  </p>
<p><strong>ARP高速缓存的查看和修改</strong>  </p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241105153907517.png" alt="image-20241105153907517"></p>
<h5 id="DNS工作原理"><a href="#DNS工作原理" class="headerlink" title="DNS工作原理"></a>DNS工作原理</h5><h5 id="socket和TCP-IP协议族的关系"><a href="#socket和TCP-IP协议族的关系" class="headerlink" title="socket和TCP&#x2F;IP协议族的关系"></a>socket和TCP&#x2F;IP协议族的关系</h5><p>​	1.数据链路层、网络层、传输层协议是在内核中实现的。因此操作系统需要实现一组系统调用，使得应用程序能够访问这些协议提供的服务。实现这组系统调用的API（Application Programming Interface，应用程序编程接口）主要有两套：socket和XTI。XTI现在基本不再使用  。<br>​	2.由socket定义的这一组API提供如下两点功能：一是将应用程序数据从用户缓冲区中复制到TCP&#x2F;UDP内核发送缓冲区，以交付内核来发送数据（比如图1-5所示的send函数），或者是从内核TCP&#x2F;UDP接收缓冲区中复制数据到用户缓冲区，以读取数据；二是应用程序可以通过它们来修改内核中各层协议的某些头部信息或其他数据结构，从而精细地控制底层通信的行为。比如可以通过setsockopt函数来设置IP数据报在网络上的存活时间。<br>​	3.socket是一套通用网络编程接口，它不但可以访问内核中TCP&#x2F;IP协议栈，而且可以访问其他网络协议栈（比如X.25协议栈、UNIX本地域协议栈等）。  </p>
<h4 id="第二章-IP协议详解"><a href="#第二章-IP协议详解" class="headerlink" title="第二章 IP协议详解"></a>第二章 IP协议详解</h4><h4 id="第三章-TCP协议详解"><a href="#第三章-TCP协议详解" class="headerlink" title="第三章 TCP协议详解"></a>第三章 TCP协议详解</h4><h4 id="第四章-TCP-IP通信案例访问Internet"><a href="#第四章-TCP-IP通信案例访问Internet" class="headerlink" title="第四章 TCP&#x2F;IP通信案例访问Internet"></a>第四章 TCP&#x2F;IP通信案例访问Internet</h4>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/25/Quartus%20II%E5%BC%80%E5%8F%91FPGA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/25/Quartus%20II%E5%BC%80%E5%8F%91FPGA/" class="post-title-link" itemprop="url">Quartus II开发FPGA</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-10-25 08:00:00" itemprop="dateCreated datePublished" datetime="2024-10-25T08:00:00+08:00">2024-10-25</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/FPGA/" itemprop="url" rel="index"><span itemprop="name">FPGA</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>309</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="Quartus-II开发FPGA"><a href="#Quartus-II开发FPGA" class="headerlink" title="Quartus II开发FPGA"></a>Quartus II开发FPGA</h2><h3 id="一、开发流程"><a href="#一、开发流程" class="headerlink" title="一、开发流程"></a>一、开发流程</h3><h4 id="1-FPGA工程创建"><a href="#1-FPGA工程创建" class="headerlink" title="1.FPGA工程创建"></a>1.FPGA工程创建</h4><p>参考博客<a target="_blank" rel="noopener" href="https://blog.csdn.net/hyp12347/article/details/132578663">Quartus FPGA工程创建流程-CSDN博客</a><br>参考视频<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1KE411h7AZ/?spm_id_from=333.788.top_right_bar_window_custom_collection.content.click">零基础轻松学习FPGA，小梅哥FPGA设计思想与验证方法视频教程_哔哩哔哩_bilibili</a></p>
<h4 id="2-Quartus创建工程"><a href="#2-Quartus创建工程" class="headerlink" title="2.Quartus创建工程"></a>2.Quartus创建工程</h4><ul>
<li>新建工程，将verilog代码与激励块代码导入</li>
<li>选择FPGA芯片型号，仿真模式与开发语言</li>
</ul>
<h4 id="3-逻辑功能开发"><a href="#3-逻辑功能开发" class="headerlink" title="3.逻辑功能开发"></a>3.逻辑功能开发</h4><ul>
<li>完成设计文件与测试文件代码编写（testbench仿真激励代码）</li>
<li>逻辑综合（编译）</li>
</ul>
<h4 id="4-Modelsim仿真"><a href="#4-Modelsim仿真" class="headerlink" title="4.Modelsim仿真"></a>4.Modelsim仿真</h4><ul>
<li>Tools-Run Simulation Tool-RTL Simulation</li>
</ul>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241025135444403.png" alt="image-20241025135444403"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241025135718571.png" alt="image-20241025135718571"></p>
<h4 id="5-程序烧录下载"><a href="#5-程序烧录下载" class="headerlink" title="5.程序烧录下载"></a>5.程序烧录下载</h4><h3 id="二、软件使用"><a href="#二、软件使用" class="headerlink" title="二、软件使用"></a>二、软件使用</h3><ul>
<li>查看门级列表 Tools-Netlist Viewer-RTL list</li>
</ul>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241025122551691.png" alt="image-20241025122551691"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/19/C++%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/19/C++%E6%99%BA%E8%83%BD%E6%8C%87%E9%92%88%E4%B8%8E%E5%86%85%E5%AD%98%E7%AE%A1%E7%90%86/" class="post-title-link" itemprop="url">C++智能指针与内存管理</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-10-19 08:00:00" itemprop="dateCreated datePublished" datetime="2024-10-19T08:00:00+08:00">2024-10-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>11k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>10 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="unique-ptr"><a href="#unique-ptr" class="headerlink" title="unique_ptr"></a>unique_ptr</h2><h3 id="前置知识"><a href="#前置知识" class="headerlink" title="前置知识"></a>前置知识</h3><h4 id="智能指针与RAII"><a href="#智能指针与RAII" class="headerlink" title="智能指针与RAII"></a>智能指针与RAII</h4><p>RAII是一种编程技术，用于管理资源（如内存、文件句柄、网络连接等），其核心思想是将资源的生命周期与对象的生命周期绑定。<br>当对象被创建时，它获取必要的资源；当对象被销毁时，它释放这些资源。这样可以保证即使发生异常，资源也能被正确地释放。</p>
<p>智能指针是一种特殊的指针，它封装了原始指针，并在对象生命周期结束时自动释放其指向的资源。C++标准库提供了几种智能指针，如std::unique_ptr、std::shared_ptr和std::weak_ptr。<br>智能指针利用了RAII的概念，它们在构造时获取资源（通常是通过new操作符分配内存），并在析构时释放资源（通过delete操作符）。</p>
<p>智能指针是实现RAII的一种方式。通过使用智能指针，你可以确保动态分配的内存在不再需要时被自动释放，从而避免内存泄漏。</p>
<h4 id="const修饰符"><a href="#const修饰符" class="headerlink" title="const修饰符"></a>const修饰符</h4><p>const 修饰成员函数仅用于类中的成员函数时，其作用是保证该成员函数不会修改所属对象的状态</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;Student: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;, Score: &quot;</span> &lt;&lt; score &lt;&lt; std::endl;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="default修饰符"><a href="#default修饰符" class="headerlink" title="default修饰符"></a>default修饰符</h4><p>显式默认构造函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Student</span>() = <span class="keyword">default</span>;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<ul>
<li>构造函数：如 Student() &#x3D; default;，告诉编译器自动生成默认的无参构造函数。</li>
<li>析构函数：~Student() &#x3D; default;，告诉编译器自动生成默认的析构函数。</li>
<li>拷贝构造函数和拷贝赋值运算符：如果没有特别的要求，使用 &#x3D; default 可以让编译器生成默认的拷贝构造和赋值运算符。</li>
</ul>
<p>当你需要让类有特定行为（如自定义构造、析构等），但仍然希望保留编译器生成的某些默认行为时，可以用 &#x3D; default 显式要求编译器生成这些函数。</p>
<h4 id="类型转换"><a href="#类型转换" class="headerlink" title="类型转换"></a>类型转换</h4><h5 id="static-cast"><a href="#static-cast" class="headerlink" title="static_cast"></a>static_cast</h5><p>含义</p>
<ul>
<li><code>static_cast</code> 是一种类型安全的转换，可以在不进行运行时检查的情况下转换类型。</li>
</ul>
<p>用途</p>
<ul>
<li>用于已知类型之间的转换，如基本数据类型、类层次结构中的上行或下行转换（当确定转换是安全时）。</li>
</ul>
<p>示例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">double</span> b = <span class="built_in">static_cast</span>&lt;<span class="type">double</span>&gt;(a); <span class="comment">// 基本数据类型转换</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123;&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;&#125;;</span><br><span class="line"></span><br><span class="line">Base* basePtr = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">Derived* derivedPtr = <span class="built_in">static_cast</span>&lt;Derived*&gt;(basePtr); <span class="comment">// 注意：没有安全检查</span></span><br></pre></td></tr></table></figure>

<h5 id="reinterpret-cast"><a href="#reinterpret-cast" class="headerlink" title="reinterpret_cast"></a>reinterpret_cast</h5><p>含义</p>
<ul>
<li><code>reinterpret_cast</code> 用于进行低级别的类型转换，几乎可以将任何指针类型转换为任何其他指针类型。</li>
</ul>
<p>用途</p>
<ul>
<li>主要用于处理底层操作，如指针的位表示。由于它不进行任何类型检查，使用时需要小心。</li>
</ul>
<p>示例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">void</span>* ptr = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">void</span>*&gt;(&amp;a); <span class="comment">// 将 int* 转换为 void*</span></span><br><span class="line"><span class="type">int</span>* intPtr = <span class="built_in">reinterpret_cast</span>&lt;<span class="type">int</span>*&gt;(ptr); <span class="comment">// 再次转换回 int*</span></span><br></pre></td></tr></table></figure>

<h5 id="const-cast"><a href="#const-cast" class="headerlink" title="const_cast"></a>const_cast</h5><p>含义</p>
<ul>
<li><code>const_cast</code> 用于添加或去除对象的 <code>const</code> 或 <code>volatile</code> 属性。</li>
</ul>
<p>用途</p>
<ul>
<li>主要用于需要修改一个常量对象的场景，但要小心使用，因为这可能导致未定义行为。</li>
</ul>
<p>示例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">int</span> a = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span>* b = <span class="built_in">const_cast</span>&lt;<span class="type">int</span>*&gt;(&amp;a); <span class="comment">// 去除 const 属性</span></span><br><span class="line">*b = <span class="number">20</span>; <span class="comment">// 这是不安全的，可能导致未定义行为</span></span><br></pre></td></tr></table></figure>

<h5 id="dynamic-cast"><a href="#dynamic-cast" class="headerlink" title="dynamic_cast"></a>dynamic_cast</h5><p>含义</p>
<ul>
<li><code>dynamic_cast</code> 用于在类层次结构中进行安全的向下转换（downcasting）。</li>
</ul>
<p>用途</p>
<ul>
<li>主要用于多态类型（即有虚函数的类）之间的安全转换，能够检查转换是否成功。如果转换失败，返回 <code>nullptr</code>（对于指针）或抛出 <code>std::bad_cast</code>（对于引用）。</li>
</ul>
<p>示例</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Base</span> &#123; <span class="function"><span class="keyword">virtual</span> <span class="type">void</span> <span class="title">func</span><span class="params">()</span> </span>&#123;&#125; &#125;; <span class="comment">// 有虚函数</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Derived</span> : <span class="keyword">public</span> Base &#123;&#125;;</span><br><span class="line"></span><br><span class="line">Base* basePtr = <span class="keyword">new</span> <span class="built_in">Derived</span>();</span><br><span class="line">Derived* derivedPtr = <span class="built_in">dynamic_cast</span>&lt;Derived*&gt;(basePtr); <span class="comment">// 安全转换</span></span><br><span class="line"><span class="keyword">if</span> (derivedPtr) &#123;</span><br><span class="line">    <span class="comment">// 转换成功</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h5 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h5><ul>
<li><p>**<code>const_cast</code>**：添加或去除 <code>const</code> 属性。用于处理常量性。</p>
</li>
<li><p>**<code>dynamic_cast</code>**：安全地在类层次结构中转换，支持运行时检查。用于多态类型的安全转换。</p>
</li>
<li><p>**<code>static_cast</code>**：类型安全的转换，适用于已知的类型关系。基本类型之间转换</p>
</li>
<li><p>**<code>reinterpret_cast</code>**：用于低级别转换，没有安全检查。</p>
</li>
</ul>
<h4 id="move-forward"><a href="#move-forward" class="headerlink" title="move&#x2F;forward"></a>move&#x2F;forward</h4><h5 id="左值"><a href="#左值" class="headerlink" title="左值"></a>左值</h5><p><strong>定义</strong>：左值是指有名称并且可以在内存中持久存在的对象。它们可以出现在赋值操作的左侧。</p>
<p><strong>特点</strong>：</p>
<ul>
<li><p>具有持久的地址，可以取地址（使用 <code>&amp;</code> 运算符）。</p>
</li>
<li><p>通常是变量或对象。</p>
</li>
</ul>
<h5 id="右值"><a href="#右值" class="headerlink" title="右值"></a>右值</h5><p><strong>定义</strong>：右值是指临时对象或字面量，它们没有名称，通常是不能在内存中持久存在的对象。右值出现在赋值操作的右侧。</p>
<p><strong>特点</strong>：</p>
<ul>
<li>不具有持久的地址，通常是临时计算结果。</li>
<li>不能取地址。</li>
</ul>
<h5 id="区别"><a href="#区别" class="headerlink" title="区别"></a>区别</h5><ul>
<li><strong>持久性</strong>：左值有持久的内存地址，可以在代码中多次引用；而右值是临时的，通常只在表达式中存在一次。</li>
<li><strong>可修改性</strong>：左值可以被修改，右值通常不能直接修改（因为它们没有名称）。</li>
</ul>
<h5 id="move"><a href="#move" class="headerlink" title="move"></a>move</h5><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;utility&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">MyClass</span>() &#123; std::cout &lt;&lt; <span class="string">&quot;Constructed\n&quot;</span>; &#125;</span><br><span class="line">    <span class="built_in">MyClass</span>(<span class="type">const</span> MyClass&amp;) &#123; std::cout &lt;&lt; <span class="string">&quot;Copied\n&quot;</span>; &#125;</span><br><span class="line">    <span class="built_in">MyClass</span>(MyClass&amp;&amp;) <span class="keyword">noexcept</span> &#123; std::cout &lt;&lt; <span class="string">&quot;Moved\n&quot;</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">process</span><span class="params">(MyClass obj)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// Do something with obj</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    MyClass a;               <span class="comment">// a 是左值</span></span><br><span class="line">    <span class="built_in">process</span>(std::<span class="built_in">move</span>(a));  <span class="comment">// std::move(a) 是右值</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>在这个示例中，<code>process</code> 函数的参数是一个 <code>MyClass</code> 对象：</p>
<ul>
<li><p>当我们调用 <code>process(std::move(a))</code> 时，我们将 <code>a</code> 转换为右值，以便在 <code>process</code> 函数中通过移动构造函数创建 <code>obj</code>。</p>
</li>
<li><p>这样，<code>obj</code> 可能会通过移动构造来初始化，而不是通过复制构造。输出将会显示 “Moved”，而不是 “Copied”，这表明资源被成功转移而不是重复创建。</p>
</li>
<li><p>在 <code>main</code> 函数中，<code>a</code> 是一个左值，因为它是一个有名称的对象，存在于内存中。</p>
</li>
<li><p>当我们调用 <code>std::move(a)</code> 时，<code>std::move</code> 将 <code>a</code> 转换为右值，这表示我们希望转移 <code>a</code> 的资源到 <code>process</code> 函数中。此时，<code>a</code> 可以被视为一个临时对象，所有权可以被移动。</p>
</li>
</ul>
<h6 id="移动语义"><a href="#移动语义" class="headerlink" title="移动语义"></a>移动语义</h6><ul>
<li><strong>减少复制开销</strong>：右值可以通过移动构造函数或移动赋值运算符来转移资源，而不是复制。这对于管理大量数据的对象（如容器、文件句柄等）尤其重要。</li>
<li><strong>效率</strong>：移动操作通常比复制操作要快，因为它只需要转移指针或其他简单的资源标识符，而不是复制整个对象的内容。</li>
</ul>
<h6 id="表示所有权转移"><a href="#表示所有权转移" class="headerlink" title="表示所有权转移"></a>表示所有权转移</h6><ul>
<li><strong>语义清晰</strong>：使用 <code>std::move</code> 明确表示我们不再需要原来的对象，可以将其资源转移到另一个对象中。这样，调用者（如 <code>process</code> 函数）能够明确知道它将获得资源的所有权。</li>
</ul>
<h5 id="forward"><a href="#forward" class="headerlink" title="forward"></a>forward</h5><h4 id="noexcept"><a href="#noexcept" class="headerlink" title="noexcept"></a>noexcept</h4><p>用于指示某个函数不会抛出异常。使用 <code>noexcept</code> 可以帮助编译器进行优化，生成更高效的代码，并在运行时提供更好的异常安全性</p>
<p><strong>使用方式</strong>：</p>
<ul>
<li><p>在函数声明中使用：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">myFunction</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 该函数不会抛出异常</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>在表达式中使用，判断一个函数是否可能抛出异常：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">static_assert</span>(<span class="built_in">noexcept</span>(<span class="built_in">myFunction</span>()), <span class="string">&quot;myFunction may throw!&quot;</span>);</span><br></pre></td></tr></table></figure></li>
</ul>
<p><code>static_assert(noexcept(myFunction()), &quot;myFunction may throw!&quot;);</code> 是一个编译时断言，用于检查 <code>myFunction</code> 是否声明为 <code>noexcept</code>。</p>
<p><strong>详细解释：</strong></p>
<ol>
<li>**<code>noexcept(myFunction())</code>**：这个表达式检查 <code>myFunction</code> 是否会抛出异常。如果 <code>myFunction</code> 是 <code>noexcept</code> 的，结果为 <code>true</code>；否则为 <code>false</code>。</li>
<li>**<code>static_assert</code>**：这是一个在编译时进行检查的语句。如果其第一个参数为 <code>false</code>，编译器会产生错误，并输出第二个参数的错误信息。这样，开发者可以在编译时捕捉到潜在的问题。</li>
<li><strong>错误信息</strong>：如果 <code>myFunction</code> 可能抛出异常（即 <code>noexcept(myFunction())</code> 为 <code>false</code>），编译器将显示 <code>&quot;myFunction may throw!&quot;</code> 的错误信息，提示开发者。</li>
</ol>
<p><strong>示例：</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">myFunction</span><span class="params">()</span> <span class="keyword">noexcept</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 不会抛出异常</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">static_assert</span>(<span class="built_in">noexcept</span>(<span class="built_in">myFunction</span>()), <span class="string">&quot;myFunction may throw!&quot;</span>); <span class="comment">// 通过检查</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">anotherFunction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">throw</span> std::<span class="built_in">runtime_error</span>(<span class="string">&quot;Error&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">static_assert</span>(<span class="built_in">noexcept</span>(<span class="built_in">anotherFunction</span>()), <span class="string">&quot;anotherFunction may throw!&quot;</span>); <span class="comment">// 编译时错误</span></span><br></pre></td></tr></table></figure>

<h4 id="constexpr"><a href="#constexpr" class="headerlink" title="constexpr"></a>constexpr</h4><p>用于指示某个函数或变量在编译时可被求值。它使得在编译期间进行常量计算成为可能，通常用于优化性能。</p>
<p><strong>使用方式</strong>：</p>
<ul>
<li><p>用于函数声明：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>用于变量声明：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constexpr</span> <span class="type">int</span> maxSize = <span class="number">100</span>; <span class="comment">// 编译时常量</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>可以与 <code>if</code>、<code>for</code> 等控制结构结合使用，使得复杂计算在编译时完成：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">constexpr</span> <span class="type">int</span> <span class="title">factorial</span><span class="params">(<span class="type">int</span> n)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> (n &lt;= <span class="number">1</span>) ? <span class="number">1</span> : n * <span class="built_in">factorial</span>(n - <span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<p><strong>优势</strong>：</p>
<ol>
<li><strong>编译时计算</strong>：减少运行时计算的开销，提高程序性能。</li>
<li><strong>类型安全</strong>：使用 <code>constexpr</code> 可以确保在编译时进行类型检查，从而降低运行时错误的可能性。</li>
<li><strong>优化常量表达式</strong>：可以用于数组大小、模板参数等需要编译时常量的场合。</li>
</ol>
<h4 id="左值引用与右值引用"><a href="#左值引用与右值引用" class="headerlink" title="左值引用与右值引用"></a>左值引用与右值引用</h4><h5 id="左值引用"><a href="#左值引用" class="headerlink" title="左值引用"></a>左值引用</h5><p>通过&amp;获得左值引用，左值引用只能绑定左值。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> intValue1 = <span class="number">10</span>;</span><br><span class="line"><span class="comment">//将intValue1绑定到intValue2和intValue3</span></span><br><span class="line"><span class="type">int</span> &amp;intValue2 = intValue1, &amp;intValue3 = intValue2;</span><br><span class="line">intValue2 = <span class="number">100</span>;</span><br><span class="line">std::cout &lt;&lt; intValue1 &lt;&lt; std::endl;<span class="comment">//100</span></span><br><span class="line">std::cout &lt;&lt; intValue2 &lt;&lt; std::endl;<span class="comment">//100</span></span><br><span class="line">std::cout &lt;&lt; intValue3 &lt;&lt; std::endl;<span class="comment">//100</span></span><br></pre></td></tr></table></figure>

<p>不能将左值引用绑定到一个右值，但是<strong>const的左值引用可以</strong>，常量引用不能修改绑定对象的值</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> &amp;intValue1 = <span class="number">10</span>;<span class="comment">//错误</span></span><br><span class="line"><span class="type">const</span> <span class="type">int</span> &amp;intValue2 = <span class="number">10</span>;<span class="comment">//正确</span></span><br></pre></td></tr></table></figure>

<h5 id="右值引用"><a href="#右值引用" class="headerlink" title="右值引用"></a>右值引用</h5><p>通过&amp;&amp;获得右值引用，右值引用只能绑定右值<br>右值引用的好处是减少右值作为参数传递时的复制开销</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> intValue = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> &amp;&amp;intValue2 = <span class="number">10</span>;<span class="comment">//正确</span></span><br><span class="line"><span class="type">int</span> &amp;&amp;intValue3 = intValue;<span class="comment">//错误</span></span><br></pre></td></tr></table></figure>

<p>使用std::move可以获得绑定到一个左值的右值引用</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> intValue = <span class="number">10</span>;</span><br><span class="line"><span class="type">int</span> &amp;&amp;intValue3 = std::<span class="built_in">move</span>(intValue);</span><br></pre></td></tr></table></figure>

<h4 id="C-移动构造-拷贝构造"><a href="#C-移动构造-拷贝构造" class="headerlink" title="C++移动构造&#x2F;拷贝构造"></a>C++移动构造&#x2F;拷贝构造</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 拷贝构造函数 拷贝构造：复制资源，两个对象拥有自己的副本，可能导致性能问题。</span></span><br><span class="line">	<span class="built_in">Student</span>(<span class="type">const</span> Student&amp; other) : <span class="built_in">name</span>(other.name), <span class="built_in">score</span>(other.score) &#123;</span><br><span class="line">    	std::cout &lt;&lt; <span class="string">&quot;Copied: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 移动构造函数 移动构造：转移资源的所有权，通常更加高效，源对象在移动后可能处于未定义状态。</span></span><br><span class="line">	<span class="built_in">Student</span>(Student&amp;&amp; other) <span class="keyword">noexcept</span> </span><br><span class="line">    : <span class="built_in">name</span>(std::<span class="built_in">move</span>(other.name)), <span class="built_in">score</span>(other.score) &#123;</span><br><span class="line">    	std::cout &lt;&lt; <span class="string">&quot;Moved: &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;\n&quot;</span>;</span><br><span class="line">    	other.score = <span class="number">0</span>; <span class="comment">// 清空源对象的状态</span></span><br><span class="line">    	other.name = <span class="string">&quot;Unknown&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>移动构造函数的触发：</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">Student <span class="title">student1</span><span class="params">(<span class="string">&quot;Ros&quot;</span>, <span class="number">95</span>)</span></span>;</span><br><span class="line">Student student2 = std::<span class="built_in">move</span>(student1); <span class="comment">// 这里触发了移动构造</span></span><br></pre></td></tr></table></figure>

<h3 id="相关api"><a href="#相关api" class="headerlink" title="相关api"></a>相关api</h3><p> std::unique_ptr 提供了一个 reset() 方法，用于重置智能指针的管理对象或将其指向新的对象。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">void reset(Student* ptr = nullptr);</span><br></pre></td></tr></table></figure>

<ul>
<li>作用：reset 用于替换当前管理的指针对象。如果智能指针已经持有一个对象，reset() 会释放当前管理的对象，然后将其指向新对象（或为空）。</li>
<li>参数：它接受一个原始指针 ptr，该指针将成为新的管理对象。如果不传参数，则会将当前指针对象重置为 nullptr，释放原来的资源。</li>
</ul>
<p>在 std::make_unique<Student>() 中，&lt;&gt; 表示这是一个模板函数的调用。具体来说，std::make_unique 是一个模板，Student 是其模板参数，表示要创建的对象类型。</p>
<p>在 std::make_unique<Student>() 的末尾有一个空的圆括号 ()，这表示调用 make_unique 函数</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">std::make_unique源码：</span><br><span class="line"><span class="keyword">template</span>&lt;<span class="keyword">typename</span> _Tp, <span class="keyword">typename</span>... _Args&gt;</span><br><span class="line"><span class="keyword">inline</span> <span class="keyword">typename</span> _MakeUniq&lt;_Tp&gt;::<span class="function">__single_object</span></span><br><span class="line"><span class="function"><span class="title">make_unique</span><span class="params">(_Args&amp;&amp;... __args)</span></span></span><br><span class="line"><span class="function"></span>&#123; <span class="keyword">return</span> <span class="built_in">unique_ptr</span>&lt;_Tp&gt;(<span class="keyword">new</span> _Tp(std::forward&lt;_Args&gt;(__args)...)); &#125;</span><br></pre></td></tr></table></figure>

<p>1.代码分析：</p>
<ul>
<li><p>模板参数：</p>
<ul>
<li>typename _Tp：表示要创建的对象类型（比如 Student）。</li>
<li>typename… _Args：表示任意数量的参数，允许传递构造对象所需的任意数量和类型的参数。</li>
</ul>
</li>
<li><p>返回类型：</p>
<ul>
<li>typename _MakeUniq&lt;_Tp&gt;::__single_object：这里使用了一个类型别名，通常是 std::unique_ptr&lt;_Tp&gt;。这个返回类型表示这个函数返回一个指向 _Tp 类型的智能指针。</li>
</ul>
</li>
<li><p>函数体：</p>
<ul>
<li>new _Tp(std::forward&lt;_Args&gt;(__args)…)：这里调用了 <em>Tp 的构造函数，传递了使用 std::forward 转发的参数。std::forward 用于完美转发参数，保持参数的值类别（左值或右值）。</em></li>
<li>_return unique_ptr&lt;_Tp&gt;(…)：创建并返回一个 std::unique_ptr，它管理新创建的对象的生命周期。</li>
</ul>
</li>
</ul>
<p>2.与 std::make_unique<Student>() 的关系</p>
<p>当你调用 std::make_unique<Student>() 时，发生的事情如下：</p>
<ul>
<li>Student 被推断为 _Tp，即要创建的对象类型。</li>
<li>空的 () 表示没有构造参数，因此 _Args 为零参数。</li>
<li>这个调用实际上转发了空的参数给 make_unique 函数，即 __args 是一个空包（没有参数）。</li>
</ul>
<p>3.小括号和尖括号的区别</p>
<ul>
<li><p>尖括号 &lt;&gt;：用于指明模板参数类型。在 std::make_unique<Student>() 中，尖括号用于指定模板类型 Student，这是模板函数的类型参数。</p>
</li>
<li><p>小括号 ()：用于调用函数或构造对象。在 std::make_unique<Student>() 中，小括号表示调用 make_unique 函数。如果有参数，则小括号中会包含这些参数；如果没有参数，如 std::make_unique<Student>()，则小括号为空。</p>
</li>
</ul>
<p>4.参数数量的不同</p>
<ul>
<li>在 make_unique 的实现中，使用了可变参数模板 (typename… <em>Args) 来支持任意数量的构造参数。</em></li>
<li>_在调用 std::make_unique<Student>() 时，如果没有提供参数，_Args 就是一个空包，允许你创建一个 Student 对象的默认实例。</li>
</ul>
<p>总结</p>
<ul>
<li><p>std::make_unique<Student>() 通过模板函数 make_unique 实现了创建智能指针的功能。</p>
</li>
<li><p>尖括号 &lt;&gt; 用于指定模板类型，而小括号 () 用于调用函数。</p>
</li>
<li><p>make_unique 的实现灵活地支持任意数量的构造参数，允许你根据需要创建不同的对象。通过这种方式，std::make_unique 不仅提高了代码的安全性和可读性，也减少了手动内存管理的负担。</p>
</li>
</ul>
<h3 id="不可拷贝特性"><a href="#不可拷贝特性" class="headerlink" title="不可拷贝特性"></a>不可拷贝特性</h3><ol>
<li>使用 std::move显式地将一个对象转换为右值引用，从而启用移动语义。它不会真的移动对象，而是指示编译器可以安全地窃取资源。</li>
<li>将 std::unique_ptr<Student> 移入 vector 中是不可以直接push_back()， 在 C++ 中，std::unique_ptr 是不可拷贝的。</li>
</ol>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">std::unique_ptr&lt;Student&gt; <span class="title">p1</span><span class="params">(<span class="keyword">new</span> Student())</span></span>;</span><br><span class="line">std::unique_ptr&lt;Student&gt; p2 = p1;  <span class="comment">// 错误：不能拷贝 unique_ptr</span></span><br><span class="line">如果你想要将 p1 的所有权转移给 p2，必须使用移动语义，即使用 std::<span class="built_in">move</span>()，将 p1 变成右值引用：</span><br><span class="line"></span><br><span class="line">std::unique_ptr&lt;Student&gt; p2 = std::<span class="built_in">move</span>(p1);  <span class="comment">// 合法：p1 的所有权转移到 p2</span></span><br><span class="line">在这之后，p1 会变为空 (<span class="literal">nullptr</span>)，而 p2 将接管 p1 原本指向的资源。</span><br><span class="line"></span><br><span class="line">students.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(student));</span><br><span class="line">将 unique_ptr 对象放入 std::vector 中，原因如下：</span><br><span class="line"><span class="number">1.</span>unique_ptr 不可拷贝：由于 unique_ptr 是独占的，不能进行拷贝操作。如果直接尝试 students.<span class="built_in">push_back</span>(student)，编译器会报错，因为 push_back 要求对 student 进行拷贝</span><br><span class="line"><span class="number">2.</span>转移所有权：使用 std::<span class="built_in">move</span>(student)，你告诉编译器，student 的资源可以被转移到 students 容器中，student 之后将不再拥有资源（即变为空）。</span><br></pre></td></tr></table></figure>

<p>完整程序如下</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Student</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    std::string name;</span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Student</span>() = <span class="keyword">default</span>;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">set</span><span class="params">(<span class="type">const</span> std::string&amp; n, <span class="type">double</span> s)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>-&gt;name = n;</span><br><span class="line">        <span class="keyword">this</span>-&gt;score = s;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">double</span> <span class="title">get_score</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> score;&#125;</span><br><span class="line">    <span class="function"><span class="type">const</span> std::string&amp; <span class="title">get_name</span><span class="params">()</span> <span class="type">const</span> </span>&#123;<span class="keyword">return</span> name;&#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">display</span><span class="params">()</span> <span class="type">const</span> </span>&#123;</span><br><span class="line">        std::cout &lt;&lt; <span class="string">&quot;name : &quot;</span> &lt;&lt; name &lt;&lt; <span class="string">&quot;\t score &quot;</span> &lt;&lt; score &lt;&lt; std::endl;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">Student</span>()&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">compare</span><span class="params">(<span class="type">const</span> std::unique_ptr&lt;Student&gt;&amp; a, <span class="type">const</span> std::unique_ptr&lt;Student&gt;&amp; b)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(a-&gt;<span class="built_in">get_score</span>() &lt; b-&gt;<span class="built_in">get_score</span>()) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">if</span>(a-&gt;<span class="built_in">get_score</span>() &gt; b-&gt;<span class="built_in">get_score</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//max(new Student())和max(new Student)效果一样 都使用默认构造函数</span></span><br><span class="line">    <span class="comment">//!智能指针写法 两种后者更好一些 </span></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;Student&gt; max(new Student());</span></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;Student&gt; min(new Student);</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;Student&gt; min = std::make_unique&lt;Student&gt;();</span></span><br><span class="line">    <span class="comment">// std::unique_ptr&lt;Student&gt; max = std::make_unique&lt;Student&gt;();</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//!这样是开辟在栈上；注意野指针 由于最后还是会指向栈上的指针，这里就不必要new开辟内存</span></span><br><span class="line">    <span class="comment">// Student *min = nullptr;</span></span><br><span class="line">    <span class="comment">// Student *max = nullptr; </span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//! 下面这种写法是最傻逼的，一个变量一行!//</span></span><br><span class="line">    <span class="comment">// Student *min,*max = new Student();</span></span><br><span class="line">    <span class="comment">//! 这样语法正确，但是此场景存在内存泄漏，因为max min后面改变指针指向，指向了栈上的元素</span></span><br><span class="line">    <span class="comment">// Student *min =  new Student();</span></span><br><span class="line">    <span class="comment">// Student *max =  new Student();</span></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    std::vector&lt;std::unique_ptr&lt;Student&gt;&gt; students;</span><br><span class="line">    std::string stu_name[] =  &#123; <span class="string">&quot;Rose&quot;</span>,<span class="string">&quot;Mike&quot;</span>,<span class="string">&quot;Eve&quot;</span>,<span class="string">&quot;Micheal&quot;</span>,<span class="string">&quot;Jack&quot;</span> &#125;;</span><br><span class="line">    <span class="type">double</span> stu_score[] = &#123; <span class="number">95</span>,<span class="number">84</span>,<span class="number">88</span>,<span class="number">64</span>,<span class="number">100</span> &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 动态创建学生对象并存储在智能指针中</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++)&#123;</span><br><span class="line">        <span class="comment">//使用 std::make_unique&lt;Student&gt;() 创建动态分配的学生对象，确保它们都在堆上分配。</span></span><br><span class="line">        <span class="keyword">auto</span> student = std::<span class="built_in">make_unique</span>&lt;Student&gt;();</span><br><span class="line">        student-&gt;<span class="built_in">set</span>(stu_name[i], stu_score[i]);</span><br><span class="line">        student-&gt;<span class="built_in">display</span>();</span><br><span class="line">        students.<span class="built_in">push_back</span>(std::<span class="built_in">move</span>(student));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    std::unique_ptr&lt;Student&gt; *min = &amp;students[<span class="number">0</span>];</span><br><span class="line">    std::unique_ptr&lt;Student&gt; *max = &amp;students[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i ++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">compare</span>(*min, students[i]) == <span class="number">1</span>)</span><br><span class="line">            min = &amp;students[i];   <span class="comment">// min指向新的智能指针</span></span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">compare</span>(*max, students[i]) == <span class="number">-1</span>)</span><br><span class="line">            max = &amp;students[i];   <span class="comment">// max指向新的智能指针</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//!min 和 max 指向 std::unique_ptr&lt;Student&gt; 的指针 解引用一层才是指向Student的指针 才可以使用-&gt;</span></span><br><span class="line">    std::cout &lt;&lt; <span class="string">&quot;The worst student : &quot;</span> &lt;&lt; (*min)-&gt;<span class="built_in">get_name</span>() &lt;&lt; std::endl;</span><br><span class="line">	std::cout &lt;&lt; <span class="string">&quot;The best student : &quot;</span> &lt;&lt; (*max)-&gt;<span class="built_in">get_name</span>() &lt;&lt; std::endl;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="shared-ptr"><a href="#shared-ptr" class="headerlink" title="shared_ptr"></a>shared_ptr</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/19/qt%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/19/qt%E5%AD%A6%E4%B9%A0%E6%80%BB%E7%BB%93/" class="post-title-link" itemprop="url">qt学习总结</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-10-19 08:00:00" itemprop="dateCreated datePublished" datetime="2024-10-19T08:00:00+08:00">2024-10-19</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>15</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="信号与槽机制"><a href="#信号与槽机制" class="headerlink" title="信号与槽机制"></a>信号与槽机制</h2><h2 id="lambda表达式"><a href="#lambda表达式" class="headerlink" title="lambda表达式"></a>lambda表达式</h2>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/13/linux%E4%BD%BF%E7%94%A8GCC%E7%BC%96%E8%AF%91STM32%E5%B9%B6%E7%A7%BB%E6%A4%8DFreeRTOS/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/13/linux%E4%BD%BF%E7%94%A8GCC%E7%BC%96%E8%AF%91STM32%E5%B9%B6%E7%A7%BB%E6%A4%8DFreeRTOS/" class="post-title-link" itemprop="url">linux使用GCC编译STM32并移植FreeRTOS</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-10-13 08:00:00" itemprop="dateCreated datePublished" datetime="2024-10-13T08:00:00+08:00">2024-10-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">嵌入式</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>101</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="linux使用GCC编译STM32并移植FreeRTOS"><a href="#linux使用GCC编译STM32并移植FreeRTOS" class="headerlink" title="linux使用GCC编译STM32并移植FreeRTOS"></a>linux使用GCC编译STM32并移植FreeRTOS</h2><h3 id="交叉编译工具链"><a href="#交叉编译工具链" class="headerlink" title="交叉编译工具链"></a>交叉编译工具链</h3><h3 id="CubeMX生成Makefile工程"><a href="#CubeMX生成Makefile工程" class="headerlink" title="CubeMX生成Makefile工程"></a>CubeMX生成Makefile工程</h3><h3 id="编译烧写"><a href="#编译烧写" class="headerlink" title="编译烧写"></a>编译烧写</h3><p><font color="red">后续学习OpenOCD研究一下编译</font></p>
<h3 id="FreeRTOS系统移植"><a href="#FreeRTOS系统移植" class="headerlink" title="FreeRTOS系统移植"></a>FreeRTOS系统移植</h3><h3 id="FreeRTOS应用之消息队列"><a href="#FreeRTOS应用之消息队列" class="headerlink" title="FreeRTOS应用之消息队列"></a>FreeRTOS应用之消息队列</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/10/13/qemu%E7%A7%BB%E6%A4%8D%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/10/13/qemu%E7%A7%BB%E6%A4%8D%E5%BC%80%E6%BA%90%E8%BD%AF%E4%BB%B6/" class="post-title-link" itemprop="url">qemu移植开源软件</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-10-13 08:00:00" itemprop="dateCreated datePublished" datetime="2024-10-13T08:00:00+08:00">2024-10-13</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/" itemprop="url" rel="index"><span itemprop="name">嵌入式</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>27k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>24 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="webserver"><a href="#webserver" class="headerlink" title="webserver"></a>webserver</h2><h3 id="boa"><a href="#boa" class="headerlink" title="boa"></a>boa</h3><h4 id="boa概述"><a href="#boa概述" class="headerlink" title="boa概述"></a>boa概述</h4><p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241015223050748.png" alt="image-20241015223050748"></p>
<h4 id="boa移植"><a href="#boa移植" class="headerlink" title="boa移植"></a>boa移植</h4><h5 id="1-解压源代码"><a href="#1-解压源代码" class="headerlink" title="1.解压源代码"></a>1.解压源代码</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tar -xvf boa-0.94.13.tar.gz </span><br></pre></td></tr></table></figure>

<h5 id="2-生成Makefile"><a href="#2-生成Makefile" class="headerlink" title="2.生成Makefile"></a>2.生成Makefile</h5><figure class="highlight v"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">cd ./boa-<span class="number">0</span><span class="variable">.94</span><span class="variable">.13</span>/src </span><br><span class="line">./configure</span><br></pre></td></tr></table></figure>

<h5 id="3-编译源代码"><a href="#3-编译源代码" class="headerlink" title="3.编译源代码"></a>3.编译源代码</h5><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">将Makefile中的下面内容：</span><br><span class="line">CC = gcc</span><br><span class="line">CPP = gcc –E</span><br><span class="line">改为（即采用交叉编译工具）：</span><br><span class="line">CC = arm-linux-gcc</span><br><span class="line">CPP = arm-linux-gcc –E</span><br></pre></td></tr></table></figure>

<h5 id="4-修改源代码-修改src-compat-h"><a href="#4-修改源代码-修改src-compat-h" class="headerlink" title="4.修改源代码 修改src&#x2F;compat.h"></a>4.修改源代码 修改src&#x2F;compat.h</h5><p>出现错误：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">compat.h:120:30: note: in definition of macro ‘TIMEZONE_OFFSET’</span><br><span class="line">#define TIMEZONE_OFFSET(foo) foo##-&gt;tm_gmtoff</span><br><span class="line">                                      ^</span><br><span class="line">make: *** [util.o] Error 1</span><br></pre></td></tr></table></figure>

<p>解决方案：</p>
<pre><code>vim compat.h 
#define TIMEZONE_OFFSET(foo) (foo)-&gt;tm_gmtoff        //修改成这个
//#define TIMEZONE_OFFSET(foo) foo##-&gt;tm_gmtoff        //注释掉

vim boa.c  //注释掉下面部分
#if 0     
    if (setuid(0) != -1) &#123;
        DIE(&quot;icky Linux kernel bug!&quot;);
    &#125;
#endif   
</code></pre>
<h5 id="5-编译-make-clean-make-j8生成boa文件"><a href="#5-编译-make-clean-make-j8生成boa文件" class="headerlink" title="5.编译 make clean &amp;&amp; make -j8生成boa文件"></a>5.编译 make clean &amp;&amp; make -j8生成boa文件</h5><p>此时再次按照自己的需求修改安装目录，着重修改如下内容：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">Port  80  </span><br><span class="line">User  0  </span><br><span class="line">Group 0  </span><br><span class="line"><span class="comment">#Listen 192.68.0.5 </span></span><br><span class="line">ErrorLog /boa/log/error_log  </span><br><span class="line">AccessLog /boa/log/access_log    </span><br><span class="line">DocumentRoot /boa/www  </span><br><span class="line">UserDir public_html  </span><br><span class="line">DirectoryIndex index.html    </span><br><span class="line">DirectoryMaker /boa/boa_indexer</span><br><span class="line">KeepAliveMax 1000  </span><br><span class="line">KeepAliveTimeout 10  </span><br><span class="line">MimeTypes /boa/mime.types </span><br><span class="line">DefaultType text/plain    </span><br><span class="line">CGIPath /bin:/usr/bin:/usr/local/bin   </span><br><span class="line">Alias /doc /usr/doc   </span><br><span class="line">ScriptAlias /cgi-bin/ /boa/cgi-bin/</span><br></pre></td></tr></table></figure>

<p>我的目录在&#x2F;etc&#x2F;boa，boa.conf配置文件如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="comment"># Boa v0.94 configuration file</span></span><br><span class="line"><span class="comment"># File format has not changed from 0.93</span></span><br><span class="line"><span class="comment"># File format has changed little from 0.92</span></span><br><span class="line"><span class="comment"># version changes are noted in the comments</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># The Boa configuration file is parsed with a lex/yacc or flex/bison</span></span><br><span class="line"><span class="comment"># generated parser.  If it reports an error, the line number will be</span></span><br><span class="line"><span class="comment"># provided; it should be easy to spot.  The syntax of each of these</span></span><br><span class="line"><span class="comment"># rules is very simple, and they can occur in any order.  Where possible</span></span><br><span class="line"><span class="comment"># these directives mimic those of NCSA httpd 1.3; I saw no reason to</span></span><br><span class="line"><span class="comment"># introduce gratuitous differences.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># $Id: boa.conf,v 1.25 2002/03/22 04:33:09 jnelson Exp $</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># The &quot;ServerRoot&quot; is not in this configuration file.  It can be compiled</span></span><br><span class="line"><span class="comment"># into the server (see defines.h) or specified on the command line with</span></span><br><span class="line"><span class="comment"># the -c option, for example:</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># boa -c /usr/local/boa</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># Port: The port Boa runs on.  The default port for http servers is 80.</span></span><br><span class="line"><span class="comment"># If it is less than 1024, the server must be started as root.</span></span><br><span class="line"></span><br><span class="line">Port 80</span><br><span class="line"></span><br><span class="line"><span class="comment"># Listen: the Internet address to bind(2) to.  If you leave it out,</span></span><br><span class="line"><span class="comment"># it takes the behavior before 0.93.17.2, which is to bind to all</span></span><br><span class="line"><span class="comment"># addresses (INADDR_ANY).  You only get one &quot;Listen&quot; directive,</span></span><br><span class="line"><span class="comment"># if you want service on multiple IP addresses, you have three choices:</span></span><br><span class="line"><span class="comment">#    1. Run boa without a &quot;Listen&quot; directive</span></span><br><span class="line"><span class="comment">#       a. All addresses are treated the same; makes sense if the addresses</span></span><br><span class="line"><span class="comment">#          are localhost, ppp, and eth0.</span></span><br><span class="line"><span class="comment">#       b. Use the VirtualHost directive below to point requests to different</span></span><br><span class="line"><span class="comment">#          files.  Should be good for a very large number of addresses (web</span></span><br><span class="line"><span class="comment">#          hosting clients).</span></span><br><span class="line"><span class="comment">#    2. Run one copy of boa per IP address, each has its own configuration</span></span><br><span class="line"><span class="comment">#       with a &quot;Listen&quot; directive.  No big deal up to a few tens of addresses.</span></span><br><span class="line"><span class="comment">#       Nice separation between clients.</span></span><br><span class="line"><span class="comment"># The name you provide gets run through inet_aton(3), so you have to use dotted</span></span><br><span class="line"><span class="comment"># quad notation.  This configuration is too important to trust some DNS.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#Listen 192.68.0.5</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#  User: The name or UID the server should run as.</span></span><br><span class="line"><span class="comment"># Group: The group name or GID the server should run as.</span></span><br><span class="line"></span><br><span class="line">User 0</span><br><span class="line">Group 0</span><br><span class="line"></span><br><span class="line"><span class="comment"># ServerAdmin: The email address where server problems should be sent.</span></span><br><span class="line"><span class="comment"># Note: this is not currently used, except as an environment variable</span></span><br><span class="line"><span class="comment"># for CGIs.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ServerAdmin root@localhost</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ErrorLog: The location of the error log file. If this does not start</span></span><br><span class="line"><span class="comment"># with /, it is considered relative to the server root.</span></span><br><span class="line"><span class="comment"># Set to /dev/null if you don&#x27;t want errors logged.</span></span><br><span class="line"><span class="comment"># If unset, defaults to /dev/stderr</span></span><br><span class="line"></span><br><span class="line">ErrorLog /etc/boa/log/error_log</span><br><span class="line"><span class="comment"># Please NOTE: Sending the logs to a pipe (&#x27;|&#x27;), as shown below,</span></span><br><span class="line"><span class="comment">#  is somewhat experimental and might fail under heavy load.</span></span><br><span class="line"><span class="comment"># &quot;Usual libc implementations of printf will stall the whole</span></span><br><span class="line"><span class="comment">#  process if the receiving end of a pipe stops reading.&quot;</span></span><br><span class="line"><span class="comment">#ErrorLog &quot;|/usr/sbin/cronolog --symlink=/var/log/boa/error_log /var/log/boa/error-%Y%m%d.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AccessLog: The location of the access log file. If this does not</span></span><br><span class="line"><span class="comment"># start with /, it is considered relative to the server root.</span></span><br><span class="line"><span class="comment"># Comment out or set to /dev/null (less effective) to disable</span></span><br><span class="line"><span class="comment"># Access logging.</span></span><br><span class="line"></span><br><span class="line">AccessLog /etc/boa/log/access_log</span><br><span class="line"><span class="comment"># Please NOTE: Sending the logs to a pipe (&#x27;|&#x27;), as shown below,</span></span><br><span class="line"><span class="comment">#  is somewhat experimental and might fail under heavy load.</span></span><br><span class="line"><span class="comment"># &quot;Usual libc implementations of printf will stall the whole</span></span><br><span class="line"><span class="comment">#  process if the receiving end of a pipe stops reading.&quot;</span></span><br><span class="line"><span class="comment">#AccessLog  &quot;|/usr/sbin/cronolog --symlink=/var/log/boa/access_log /var/log/boa/access-%Y%m%d.log&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># UseLocaltime: Logical switch.  Uncomment to use localtime</span></span><br><span class="line"><span class="comment"># instead of UTC time</span></span><br><span class="line"><span class="comment">#UseLocaltime</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VerboseCGILogs: this is just a logical switch.</span></span><br><span class="line"><span class="comment">#  It simply notes the start and stop times of cgis in the error log</span></span><br><span class="line"><span class="comment"># Comment out to disable.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#VerboseCGILogs</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ServerName: the name of this server that should be sent back to</span></span><br><span class="line"><span class="comment"># clients if different than that returned by gethostname + gethostbyname</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#ServerName www.your.org.here</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># VirtualHost: a logical switch.</span></span><br><span class="line"><span class="comment"># Comment out to disable.</span></span><br><span class="line"><span class="comment"># Given DocumentRoot /var/www, requests on interface &#x27;A&#x27; or IP &#x27;IP-A&#x27;</span></span><br><span class="line"><span class="comment"># become /var/www/IP-A.</span></span><br><span class="line"><span class="comment"># Example: http://localhost/ becomes /var/www/127.0.0.1</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># Not used until version 0.93.17.2.  This &quot;feature&quot; also breaks commonlog</span></span><br><span class="line"><span class="comment"># output rules, it prepends the interface number to each access_log line.</span></span><br><span class="line"><span class="comment"># You are expected to fix that problem with a postprocessing script.</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#VirtualHost</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DocumentRoot: The root directory of the HTML documents.</span></span><br><span class="line"><span class="comment"># Comment out to disable server non user files.</span></span><br><span class="line"></span><br><span class="line">DocumentRoot /etc/boa/www</span><br><span class="line"></span><br><span class="line"><span class="comment"># UserDir: The name of the directory which is appended onto a user&#x27;s home</span></span><br><span class="line"><span class="comment"># directory if a ~user request is recieved.</span></span><br><span class="line"></span><br><span class="line">UserDir public_html</span><br><span class="line"></span><br><span class="line"><span class="comment"># DirectoryIndex: Name of the file to use as a pre-written HTML</span></span><br><span class="line"><span class="comment"># directory index.  Please MAKE AND USE THESE FILES.  On the</span></span><br><span class="line"><span class="comment"># fly creation of directory indexes can be _slow_.</span></span><br><span class="line"><span class="comment"># Comment out to always use DirectoryMaker</span></span><br><span class="line"></span><br><span class="line">DirectoryIndex index.html</span><br><span class="line"></span><br><span class="line"><span class="comment"># DirectoryMaker: Name of program used to create a directory listing.</span></span><br><span class="line"><span class="comment"># Comment out to disable directory listings.  If both this and</span></span><br><span class="line"><span class="comment"># DirectoryIndex are commented out, accessing a directory will give</span></span><br><span class="line"><span class="comment"># an error (though accessing files in the directory are still ok).</span></span><br><span class="line"></span><br><span class="line">DirectoryMaker /etc/boa/boa_indexer</span><br><span class="line"></span><br><span class="line"><span class="comment"># DirectoryCache: If DirectoryIndex doesn&#x27;t exist, and DirectoryMaker</span></span><br><span class="line"><span class="comment"># has been commented out, the the on-the-fly indexing of Boa can be used</span></span><br><span class="line"><span class="comment"># to generate indexes of directories. Be warned that the output is</span></span><br><span class="line"><span class="comment"># extremely minimal and can cause delays when slow disks are used.</span></span><br><span class="line"><span class="comment"># Note: The DirectoryCache must be writable by the same user/group that</span></span><br><span class="line"><span class="comment"># Boa runs as.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># DirectoryCache /var/spool/boa/dircache</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># KeepAliveMax: Number of KeepAlive requests to allow per connection</span></span><br><span class="line"><span class="comment"># Comment out, or set to 0 to disable keepalive processing</span></span><br><span class="line"></span><br><span class="line">KeepAliveMax 1000</span><br><span class="line"></span><br><span class="line"><span class="comment"># KeepAliveTimeout: seconds to wait before keepalive connection times out</span></span><br><span class="line"></span><br><span class="line">KeepAliveTimeout 10</span><br><span class="line"></span><br><span class="line"><span class="comment"># MimeTypes: This is the file that is used to generate mime type pairs</span></span><br><span class="line"><span class="comment"># and Content-Type fields for boa.</span></span><br><span class="line"><span class="comment"># Set to /dev/null if you do not want to load a mime types file.</span></span><br><span class="line"><span class="comment"># Do *not* comment out (better use AddType!)</span></span><br><span class="line"></span><br><span class="line">MimeTypes /etc/boa/mime.types</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># DefaultType: MIME type used if the file extension is unknown, or there</span></span><br><span class="line"><span class="comment"># is no file extension.</span></span><br><span class="line"></span><br><span class="line">DefaultType text/plain</span><br><span class="line"></span><br><span class="line"><span class="comment"># CGIPath: The value of the $PATH environment variable given to CGI progs.</span></span><br><span class="line"></span><br><span class="line">CGIPath /bin:/usr/bin:/usr/local/bin</span><br><span class="line"></span><br><span class="line"><span class="comment"># SinglePostLimit: The maximum allowable number of bytes in</span></span><br><span class="line"><span class="comment"># a single POST.  Default is normally 1MB.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># AddType: adds types without editing mime.types</span></span><br><span class="line"><span class="comment"># Example: AddType type extension [extension ...]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Uncomment the next line if you want .cgi files to execute from anywhere</span></span><br><span class="line"><span class="comment">#AddType application/x-httpd-cgi cgi</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redirect, Alias, and ScriptAlias all have the same semantics -- they</span></span><br><span class="line"><span class="comment"># match the beginning of a request and take appropriate action.  Use</span></span><br><span class="line"><span class="comment"># Redirect for other servers, Alias for the same server, and ScriptAlias</span></span><br><span class="line"><span class="comment"># to enable directories for script execution.</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Redirect allows you to tell clients about documents which used to exist in</span></span><br><span class="line"><span class="comment"># your server&#x27;s namespace, but do not anymore. This allows you to tell the</span></span><br><span class="line"><span class="comment"># clients where to look for the relocated document.</span></span><br><span class="line"><span class="comment"># Example: Redirect /bar http://elsewhere/feh/bar</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Aliases: Aliases one path to another.</span></span><br><span class="line"><span class="comment"># Example: Alias /path1/bar /path2/foo</span></span><br><span class="line"></span><br><span class="line">Alias /doc /usr/doc</span><br><span class="line"></span><br><span class="line"><span class="comment"># ScriptAlias: Maps a virtual path to a directory for serving scripts</span></span><br><span class="line"><span class="comment"># Example: ScriptAlias /htbin/ /www/htbin/</span></span><br><span class="line"></span><br><span class="line">ScriptAlias /cgi-bin/ /etc/boa/cgi-bin/</span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h5 id="6-新建index-html和test-c"><a href="#6-新建index-html和test-c" class="headerlink" title="6.新建index.html和test.c"></a>6.新建index.html和test.c</h5><p>index.html:</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>this is a test! 2024-10-15 jym<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">img</span> <span class="attr">src</span>=<span class="string">&quot;oei.jpg&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h3</span>&gt;</span>tree picture<span class="tag">&lt;/<span class="name">h3</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/cgi-bin/test.cgi&quot;</span>&gt;</span>to cgi page<span class="tag">&lt;/<span class="name">a</span>&gt;</span>    //指定了cgi可执行文件存放的路径，默认从/boa的根目录开始查找</span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span> j</span><br></pre></td></tr></table></figure>



<p>test.c:</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="type">int</span> <span class="title function_">main</span><span class="params">()</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;Content-type:text/html\n\n&quot;</span>); <span class="comment">//这句一定要加上</span></span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&lt;html&gt;&lt;body&gt;&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&lt;font style=\&quot;color:red; font-size:30px;\&quot;&gt;Hello, CGI!&lt;/font&gt;&lt;br/&gt;&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&lt;a href=\&quot;/index.html\&quot;&gt;return index.html&lt;/a&gt;&quot;</span>);</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">&quot;&lt;/body&gt;&lt;/html&gt;&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><em>gcc -o test.cgi test.c</em> 生成测试所用的test.cgi</p>
<h5 id="7-拷贝相关文件"><a href="#7-拷贝相关文件" class="headerlink" title="7.拷贝相关文件"></a>7.拷贝相关文件</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cp</span> boa boa_indexer test.cgi index.html ../boa.conf ../../arm64_boa</span><br><span class="line"><span class="built_in">cd</span> ../../arm64_boa</span><br><span class="line"><span class="built_in">mkdir</span> www cgi-bin <span class="built_in">log</span></span><br><span class="line"><span class="built_in">sudo</span> <span class="built_in">cp</span> /etc/mime.types ./</span><br><span class="line"><span class="built_in">mv</span> index.html www</span><br><span class="line"><span class="built_in">mv</span> test.cgi cgi-bin</span><br><span class="line"><span class="built_in">cp</span> ~/pics/oei.jpg ./www</span><br></pre></td></tr></table></figure>



<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017093215392.png" alt="image-20241017093215392"></p>
<h5 id="8-ARM移植"><a href="#8-ARM移植" class="headerlink" title="8.ARM移植"></a>8.ARM移植</h5><p>PC:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cp ./arm64_boa ../rootfs #rootfs是我所设置的nfs挂载目录</span><br></pre></td></tr></table></figure>

<p>虚拟ARM:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mount -t nfs -o proto=tcp,nolock 10.0.0.1:/home/jym/code/linux/qemu/rootfs /mnt</span><br></pre></td></tr></table></figure>

<p>将对应文件从&#x2F;mnt文件夹中拷贝到对应目录 可执行文件放在&#x2F;usr&#x2F;sbin boa对应文件放在&#x2F;etc&#x2F;boa</p>
<p>第一遍运行出现如下问题：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[root@FriendlyARM /]# ./boa</span><br><span class="line">gethostbyname:: Success</span><br></pre></td></tr></table></figure>

<p>解决办法：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vim boa.conf <span class="comment">#添加如下内容即可</span></span><br><span class="line">ServerName www.mydomain.com</span><br></pre></td></tr></table></figure>

<h5 id="9-运行测试"><a href="#9-运行测试" class="headerlink" title="9.运行测试"></a>9.运行测试</h5><p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017092231141.png" alt="image-20241017092231141"></p>
<p>注意这里我们的虚拟开发板是10.0.0.2，在移植过程中，我先在x86平台上移植了boa，本地地址为127.0.0.1或者10.0.0.1都是如下所示画面，但是10.0.0.2却是原来的bo官方界面，后续移植的时候，我将虚拟平台上的boa重命名为boa_old，其中&#x2F;etc&#x2F;boa和&#x2F;usr&#x2F;sbin中都存在，然后将我生成的文件拷贝到&#x2F;etc&#x2F;boa中关掉之前的boa服务再次运行即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps | grep boa</span><br><span class="line"><span class="built_in">kill</span> 进程号</span><br></pre></td></tr></table></figure>

<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017092608730.png" alt="image-20241017092608730"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017092209961.png" alt="image-20241017092209961"></p>
<h3 id="GoAhead"><a href="#GoAhead" class="headerlink" title="GoAhead"></a>GoAhead</h3><p><font color="red">后续移植</font></p>
<h4 id="GoAhead概述"><a href="#GoAhead概述" class="headerlink" title="GoAhead概述"></a>GoAhead概述</h4><h4 id="GoAhead移植"><a href="#GoAhead移植" class="headerlink" title="GoAhead移植"></a>GoAhead移植</h4><h2 id="madplay"><a href="#madplay" class="headerlink" title="madplay"></a>madplay</h2><h3 id="madplay概述"><a href="#madplay概述" class="headerlink" title="madplay概述"></a>madplay概述</h3><p>Madplay是一个开源mp3解码库，对mp3解码算法做了很多优化</p>
<p>单纯想要播放音乐，在linux下播放MP3文件，我们可以使用sox，运行下面语句即可</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo apt-get install sox libsox-fmt-all</span><br><span class="line">play shanghaitan.mp3</span><br></pre></td></tr></table></figure>

<h3 id="madplay-PC-Linux"><a href="#madplay-PC-Linux" class="headerlink" title="madplay-PC-Linux"></a>madplay-PC-Linux</h3><h4 id="1-解压源码包"><a href="#1-解压源码包" class="headerlink" title="1.解压源码包"></a>1.解压源码包</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /arm</span><br><span class="line"><span class="built_in">mkdir</span> madplay</span><br><span class="line"><span class="built_in">cd</span> madplay</span><br><span class="line"><span class="built_in">mkdir</span> tarball src-x86 src-arm target-x86 target-arm</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> tarball</span><br><span class="line"><span class="keyword">for</span> f <span class="keyword">in</span> $(<span class="built_in">ls</span> *.tar.gz); <span class="keyword">do</span> tar -zxvf <span class="variable">$f</span> –C ../src-x86; <span class="keyword">done</span></span><br><span class="line">或者：</span><br><span class="line"><span class="built_in">cd</span> tarball</span><br><span class="line">tar -zxvf zlib-1.2.3.tar.gz -C ../src-x86</span><br><span class="line">tar -zxvf libid3tag-0.15.1b.tar.gz -C ../src-x86</span><br><span class="line">tar -zxvf libmad-0.15.1b.tar.gz -C ../src-x86</span><br><span class="line">tar -zxvf madplay-0.15.2b.tar.gz -C ../src-x86</span><br></pre></td></tr></table></figure>

<p>目录说明：<br>tarball 目录用来存放所有的源代码包<br>src-x86 目录用来存放 X86 版本的所有源代码文件<br>src-arm 目录用来存放 ARM 版本的所有源代码文件<br>target-x86 目录是 X86 版本的安装目录<br>target-arm 目录是 ARM 版本的安装目录<br>接下来把从网上下载到的源代码包放入 tarball 目录</p>
<h4 id="2-编译madplay及它所依赖的库文件"><a href="#2-编译madplay及它所依赖的库文件" class="headerlink" title="2.编译madplay及它所依赖的库文件"></a>2.编译madplay及它所依赖的库文件</h4><h5 id="zlib"><a href="#zlib" class="headerlink" title="zlib"></a>zlib</h5><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">cd ../src-x86/zlib-1.2.3</span><br><span class="line">./configure --prefix=/home/jym/code/linux/qemu/madplay/target-x86</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h5 id="libid3tag"><a href="#libid3tag" class="headerlink" title="libid3tag"></a>libid3tag</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../libid3tag-0.15.1b</span><br><span class="line">./configure --prefix=/home/jym/code/linux/qemu/madplay/target-x86/  --disable-debugging --disable-shared --enable-static CPPFLAGS=-I/home/jym/code/linux/qemu/madplay/target-x86/include LDFLAGS=-L/home/jym/code/linux/qemu/madplay/target-x86/lib</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<p>其中，–disable-shared –enable-static 是指定为静态编译，不过这样并不能够进行静态编译.</p>
<h5 id="libmad"><a href="#libmad" class="headerlink" title="libmad"></a>libmad</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../libmad-0.15.1b</span><br><span class="line">./configure --prefix=/home/jym/code/linux/qemu/madplay/target-x86 --disable-debugging --disable-shared --enable-static CPPFLAGS=-I/home/jym/code/linux/qemu/madplay/target-x86/include LDFLAGS=-L/home/jym/code/linux/qemu/madplay/target-x86/lib</span><br></pre></td></tr></table></figure>

<p>如果此时 make，make install 就会报错，说是”-fforce-mem”参数不能识别。打开当前目录下的 Makefile 文件，去掉里面出现的”-fforce-mem”，再进行后续操作</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">make -j8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>

<h5 id="madplay-1"><a href="#madplay-1" class="headerlink" title="madplay"></a>madplay</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ../madplay-0.15.2b</span><br><span class="line">./configure --prefix=/home/jym/code/linux/qemu/madplay/target-x86 --disable-debugging --disable-shared --enable-static CPPFLAGS=-I/home/jym/code/linux/qemu/madplay/target-x86/include LDFLAGS=-L/home/jym/code/linux/qemu/madplay/target-x86/lib</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br></pre></td></tr></table></figure>



<p>但是，这样得到的是<strong>动态链接</strong>。如果在 madplay-0.15.2b 目录中执行gcc 命令，并且在最后加上-static，运行以后就可以得到<strong>静态链接</strong>的程序</p>
<h5 id="静态链接"><a href="#静态链接" class="headerlink" title="静态链接"></a>静态链接</h5><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gcc -Wall -O2 -fomit-frame-pointer -o madplay madplay.o getopt.o getopt1.o version.o resample.o filter.o tag.o crc.o rgain.o player.o audio.o audio_aiff.o audio_cdda.o audio_hex.o audio_null.o audio_raw.o audio_snd.o audio_wave.o audio_oss.o -L/home/jym/code/linux/qemu/madplay/target-x86/lib /home/jym/code/linux/qemu/madplay/target-x86/lib/libmad.a /home/jym/code/linux/qemu/madplay/target-x86/lib/libid3tag.a -lz -lm -static</span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">ls</span> /home/jym/code/linux/qemu/madplay/target-x86/bin/</span><br><span class="line">abxtest  madplay</span><br></pre></td></tr></table></figure>

<p>使用file查看madplay文件</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">jym@jym-virtual-machine:~/code/linux/qemu/madplay/target-x86/bin$ file madplay</span><br><span class="line">madplay: ELF 64-bit LSB shared object, x86-64, version 1 (SYSV), dynamically linked, interpreter /lib64/ld-linux-x86-64.so.2, BuildID[sha1]=16f52c3b88a3bce95f5274f8d6b43d15b03fca25, <span class="keyword">for</span> GNU/Linux 3.2.0, not stripped</span><br><span class="line"></span><br><span class="line">jym@jym-virtual-machine:~/code/linux/qemu/madplay/src-x86/madplay-0.15.2b$ file madplay</span><br><span class="line">madplay: ELF 64-bit LSB executable, x86-64, version 1 (GNU/Linux), statically linked, BuildID[sha1]=e5deaf02bfed1309a9f82f53f4c89edcd0e45070, <span class="keyword">for</span> GNU/Linux 3.2.0, not stripped</span><br></pre></td></tr></table></figure>

<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241016232303443.png" alt="image-20241016232303443"></p>
<h4 id="3-运行测试"><a href="#3-运行测试" class="headerlink" title="3.运行测试"></a>3.运行测试</h4><p>移植完成后还有一个问题需要处理，直接运行会报错如下：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jym@jym-virtual-machine:~/code/linux/qemu/madplay/target-x86/bin$ ./madplay shanghaitan.mp3</span><br><span class="line">MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.</span><br><span class="line">audio: /dev/dsp: 没有那个文件或目录</span><br></pre></td></tr></table></figure>

<p>原因是madplay使用oss建构，在网上查找了一些资料，可以用alsa支持oss架构，<font color="red">后续我再探索</font>,root 账号下不能用audio，切记！</p>
<p>简单解决方法如下：使用madplay解码再使用aplay播放</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./madplay -o wav:- shanghaitan.mp3 | aplay</span><br></pre></td></tr></table></figure>

<p>最终效果如图所示</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241016233558824.png" alt="image-20241016233558824"></p>
<h4 id="4-构建脚本文件"><a href="#4-构建脚本文件" class="headerlink" title="4.构建脚本文件"></a>4.构建脚本文件</h4><figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># This build script is for madplay under PC-Linux</span></span><br><span class="line">MADPLAY_DIR=/home/jym/code/linux/qemu/madplay</span><br><span class="line">TARBALL_DIR=<span class="variable">$MADPLAY_DIR</span>/tarball</span><br><span class="line">SRC_DIR=<span class="variable">$MADPLAY_DIR</span>/src-x86</span><br><span class="line">TARGET_DIR=<span class="variable">$MADPLAY_DIR</span>/target-x86</span><br><span class="line"></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/zlib-1.2.3.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/libid3tag-0.15.1b.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/libmad-0.15.1b.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/madplay-0.15.2b.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line"><span class="comment"># for f in $(ls $TARBALL_DIR/*.tar.gz); do tar -zxvf $f -C $SRC_DIR; done</span></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/zlib-1.2.3</span><br><span class="line">./configure --prefix=<span class="variable">$TARGET_DIR</span></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/libid3tag-0.15.1b</span><br><span class="line">./configure --prefix=<span class="variable">$TARGET_DIR</span> --disable-debugging --disable-shared --enable-static CPPFLAGS=-I<span class="variable">$TARGET_DIR</span>/include LDFLAGS=-L<span class="variable">$TARGET_DIR</span>/lib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/libmad-0.15.1b</span><br><span class="line">./configure --prefix=<span class="variable">$TARGET_DIR</span> --disable-debugging --disable-shared --enable-static CPPFLAGS=-I<span class="variable">$TARGET_DIR</span>/include LDFLAGS=-L<span class="variable">$TARGET_DIR</span>/lib</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;s/-fforce-mem //g&#x27;</span> Makefile &gt; Makefile.bak</span><br><span class="line"><span class="built_in">mv</span> Makefile.bak Makefile</span><br><span class="line"></span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/madplay-0.15.2b</span><br><span class="line">./configure --prefix=<span class="variable">$TARGET_DIR</span> --disable-debugging --disable-shared --enable-static CPPFLAGS=-I<span class="variable">$TARGET_DIR</span>/include LDFLAGS=-L<span class="variable">$TARGET_DIR</span>/lib</span><br><span class="line">make</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">gcc -Wall -O2 -fomit-frame-pointer -o madplay-s madplay.o getopt.o getopt1.o version.o resample.o filter.o tag.o crc.o rgain.o player.o audio.o audio_aiff.o audio_cdda.o audio_hex.o audio_null.o audio_raw.o audio_snd.o audio_wave.o audio_oss.o -L<span class="variable">$TARGET_DIR</span>/lib <span class="variable">$TARGET_DIR</span>/lib/libmad.a <span class="variable">$TARGET_DIR</span>/lib/libid3tag.a -lz -lm -static</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> madplay madplay-d</span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$TARGET_DIR</span>/bin/madplay <span class="variable">$TARGET_DIR</span>/bin/madplay-d</span><br><span class="line"><span class="built_in">cp</span> -a madplay-s <span class="variable">$TARGET_DIR</span>/bin</span><br></pre></td></tr></table></figure>



<h3 id="madplay-ARM-Linux"><a href="#madplay-ARM-Linux" class="headerlink" title="madplay-ARM-Linux"></a>madplay-ARM-Linux</h3><h4 id="1-构建脚本"><a href="#1-构建脚本" class="headerlink" title="1.构建脚本"></a>1.构建脚本</h4><p>移植ARM-Linux版本和上述PC端流程类似，使用交叉编译器即可，这里给出编译脚本，一键运行即可</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="comment"># This build script is for madplay under ARM-Linux</span></span><br><span class="line">MADPLAY_DIR=/home/jym/code/linux/qemu/madplay</span><br><span class="line">TARBALL_DIR=<span class="variable">$MADPLAY_DIR</span>/tarball</span><br><span class="line">SRC_DIR=<span class="variable">$MADPLAY_DIR</span>/src-arm</span><br><span class="line">TARGET_DIR=<span class="variable">$MADPLAY_DIR</span>/target-arm</span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/zlib-1.2.3.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/libid3tag-0.15.1b.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/libmad-0.15.1b.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line">tar -zxvf <span class="variable">$TARBALL_DIR</span>/madplay-0.15.2b.tar.gz -C <span class="variable">$SRC_DIR</span></span><br><span class="line"><span class="comment"># for f in $(ls $TARBALL_DIR/*.tar.gz); do tar -zxvf $f -C $SRC_DIR; done</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">export</span> CC=arm-linux-gcc</span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/zlib-1.2.3</span><br><span class="line">./configure --prefix=<span class="variable">$TARGET_DIR</span></span><br><span class="line">make -j8</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/libid3tag-0.15.1b</span><br><span class="line">./configure --host=arm-linux --prefix=<span class="variable">$TARGET_DIR</span> --disable-debugging --disable-shared --enable-static CPPFLAGS=-I<span class="variable">$TARGET_DIR</span>/include LDFLAGS=-L<span class="variable">$TARGET_DIR</span>/lib</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/libmad-0.15.1b</span><br><span class="line">./configure --host=arm-linux --prefix=<span class="variable">$TARGET_DIR</span> --disable-debugging --disable-shared --enable-static CPPFLAGS=-I<span class="variable">$TARGET_DIR</span>/include LDFLAGS=-L<span class="variable">$TARGET_DIR</span>/lib</span><br><span class="line"></span><br><span class="line">sed <span class="string">&#x27;s/-fforce-mem //g&#x27;</span> Makefile &gt; Makefile.bak</span><br><span class="line"><span class="built_in">mv</span> Makefile.bak Makefile</span><br><span class="line"></span><br><span class="line">make -j8</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="built_in">cd</span> <span class="variable">$SRC_DIR</span>/madplay-0.15.2b</span><br><span class="line">./configure --host=arm-linux --prefix=<span class="variable">$TARGET_DIR</span> --disable-debugging --disable-shared --enable-static CPPFLAGS=-I<span class="variable">$TARGET_DIR</span>/include LDFLAGS=-L<span class="variable">$TARGET_DIR</span>/lib</span><br><span class="line">make -j8</span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line">arm-linux-gcc -Wall -O2 -fomit-frame-pointer -o madplay-s madplay.o getopt.o getopt1.o version.o resample.o filter.o tag.o crc.o rgain.o player.o audio.o audio_aiff.o audio_cdda.o audio_hex.o audio_null.o audio_raw.o audio_snd.o audio_wave.o audio_oss.o -L<span class="variable">$TARGET_DIR</span>/lib <span class="variable">$TARGET_DIR</span>/lib/libmad.a <span class="variable">$TARGET_DIR</span>/lib/libid3tag.a -lz -lm -static</span><br><span class="line"></span><br><span class="line"><span class="built_in">mv</span> madplay madplay-d</span><br><span class="line"><span class="built_in">mv</span> <span class="variable">$TARGET_DIR</span>/bin/madplay <span class="variable">$TARGET_DIR</span>/bin/madplay-d</span><br><span class="line"><span class="built_in">cp</span> -a madplay-s <span class="variable">$TARGET_DIR</span>/bin</span><br></pre></td></tr></table></figure>

<p>这里经过验证，是可以不报错运行完毕的，生成的相关文件信息如下：</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017090810624.png" alt="image-20241017090810624">!<img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017090719513.png" alt="image-20241017090719513"></p>
<h4 id="2-运行验证"><a href="#2-运行验证" class="headerlink" title="2.运行验证"></a>2.运行验证</h4><p>启动虚拟arm平台</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017091028207.png" alt="image-20241017091028207"></p>
<p>音乐成功响起</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241017091252686.png" alt="image-20241017091252686"></p>
<p>生成的相关信息如下</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br></pre></td><td class="code"><pre><span class="line">MPEG Audio Decoder 0.15.2 (beta) - Copyright (C) 2000-2004 Robert Leslie et al.</span><br><span class="line">          Title: ▒Ϻ▒̲</span><br><span class="line">         Artist: Ҷ▒▒▒▒</span><br><span class="line">           Year: 2000</span><br><span class="line">          Genre: Goa</span><br><span class="line">&lt;3&gt;__free_from_pool: freeing wrong coherent size from pool</span><br><span class="line">__free_from_pool: freeing wrong coherent size from pool</span><br><span class="line">[&lt;800151e8&gt;] (unwind_backtrace+0x0/0xf0) from [&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0)</span><br><span class="line">[&lt;800151e8&gt;] (unwind_backtrace+0x0/0xf0) from [&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0)</span><br><span class="line">[&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0) from [&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8)</span><br><span class="line">[&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0) from [&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8)</span><br><span class="line">[&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8) from [&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54)</span><br><span class="line">[&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8) from [&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54)</span><br><span class="line">[&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54) from [&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c)</span><br><span class="line">[&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54) from [&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c)</span><br><span class="line">[&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c) from [&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4)</span><br><span class="line">[&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c) from [&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4)</span><br><span class="line">[&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4) from [&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0)</span><br><span class="line">[&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4) from [&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0)</span><br><span class="line">[&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0) from [&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4)</span><br><span class="line">[&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0) from [&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4)</span><br><span class="line">[&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4) from [&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0)</span><br><span class="line">[&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4) from [&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0)</span><br><span class="line">[&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0) from [&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c)</span><br><span class="line">[&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0) from [&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c)</span><br><span class="line">[&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c) from [&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0)</span><br><span class="line">[&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c) from [&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0)</span><br><span class="line">[&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0) from [&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74)</span><br><span class="line">[&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0) from [&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74)</span><br><span class="line">[&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74) from [&lt;80283258&gt;] (snd_pcm_oss_get_format+0x10/0x28)</span><br><span class="line">[&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74) from [&lt;80283258&gt;] (snd_pcm_oss_get_format+0x10/0x28)</span><br><span class="line">[&lt;80283258&gt;] (snd_pcm_oss_get_format+0x10/0x28) from [&lt;80283ed8&gt;] (snd_pcm_oss_ioctl+0x438/0xd2c)</span><br><span class="line">[&lt;80283258&gt;] (snd_pcm_oss_get_format+0x10/0x28) from [&lt;80283ed8&gt;] (snd_pcm_oss_ioctl+0x438/0xd2c)</span><br><span class="line">[&lt;80283ed8&gt;] (snd_pcm_oss_ioctl+0x438/0xd2c) from [&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0)</span><br><span class="line">[&lt;80283ed8&gt;] (snd_pcm_oss_ioctl+0x438/0xd2c) from [&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0)</span><br><span class="line">[&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0) from [&lt;800c7204&gt;] (sys_ioctl+0x38/0x60)</span><br><span class="line">[&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0) from [&lt;800c7204&gt;] (sys_ioctl+0x38/0x60)</span><br><span class="line">[&lt;800c7204&gt;] (sys_ioctl+0x38/0x60) from [&lt;8000e2c0&gt;] (ret_fast_syscall+0x0/0x30)</span><br><span class="line">[&lt;800c7204&gt;] (sys_ioctl+0x38/0x60) from [&lt;8000e2c0&gt;] (ret_fast_syscall+0x0/0x30)</span><br><span class="line">&lt;3&gt;__free_from_pool: freeing wrong coherent size from pool</span><br><span class="line">__free_from_pool: freeing wrong coherent size from pool</span><br><span class="line">[&lt;800151e8&gt;] (unwind_backtrace+0x0/0xf0) from [&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0)</span><br><span class="line">[&lt;800151e8&gt;] (unwind_backtrace+0x0/0xf0) from [&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0)</span><br><span class="line">[&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0) from [&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8)</span><br><span class="line">[&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0) from [&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8)</span><br><span class="line">[&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8) from [&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54)</span><br><span class="line">[&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8) from [&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54)</span><br><span class="line">[&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54) from [&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c)</span><br><span class="line">[&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54) from [&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c)</span><br><span class="line">[&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c) from [&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4)</span><br><span class="line">[&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c) from [&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4)</span><br><span class="line">[&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4) from [&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0)</span><br><span class="line">[&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4) from [&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0)</span><br><span class="line">[&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0) from [&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4)</span><br><span class="line">[&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0) from [&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4)</span><br><span class="line">[&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4) from [&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0)</span><br><span class="line">[&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4) from [&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0)</span><br><span class="line">[&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0) from [&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c)</span><br><span class="line">[&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0) from [&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c)</span><br><span class="line">[&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c) from [&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0)</span><br><span class="line">[&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c) from [&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0)</span><br><span class="line">[&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0) from [&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74)</span><br><span class="line">[&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0) from [&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74)</span><br><span class="line">[&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74) from [&lt;80283280&gt;] (snd_pcm_oss_get_channels+0x10/0x28)</span><br><span class="line">[&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74) from [&lt;80283280&gt;] (snd_pcm_oss_get_channels+0x10/0x28)</span><br><span class="line">[&lt;80283280&gt;] (snd_pcm_oss_get_channels+0x10/0x28) from [&lt;80283fb4&gt;] (snd_pcm_oss_ioctl+0x514/0xd2c)</span><br><span class="line">[&lt;80283280&gt;] (snd_pcm_oss_get_channels+0x10/0x28) from [&lt;80283fb4&gt;] (snd_pcm_oss_ioctl+0x514/0xd2c)</span><br><span class="line">[&lt;80283fb4&gt;] (snd_pcm_oss_ioctl+0x514/0xd2c) from [&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0)</span><br><span class="line">[&lt;80283fb4&gt;] (snd_pcm_oss_ioctl+0x514/0xd2c) from [&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0)</span><br><span class="line">[&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0) from [&lt;800c7204&gt;] (sys_ioctl+0x38/0x60)</span><br><span class="line">[&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0) from [&lt;800c7204&gt;] (sys_ioctl+0x38/0x60)</span><br><span class="line">[&lt;800c7204&gt;] (sys_ioctl+0x38/0x60) from [&lt;8000e2c0&gt;] (ret_fast_syscall+0x0/0x30)</span><br><span class="line">[&lt;800c7204&gt;] (sys_ioctl+0x38/0x60) from [&lt;8000e2c0&gt;] (ret_fast_syscall+0x0/0x30)</span><br><span class="line">&lt;3&gt;__free_from_pool: freeing wrong coherent size from pool</span><br><span class="line">__free_from_pool: freeing wrong coherent size from pool</span><br><span class="line">[&lt;800151e8&gt;] (unwind_backtrace+0x0/0xf0) from [&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0)</span><br><span class="line">[&lt;800151e8&gt;] (unwind_backtrace+0x0/0xf0) from [&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0)</span><br><span class="line">[&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0) from [&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8)</span><br><span class="line">[&lt;800189c4&gt;] (arm_dma_free+0x188/0x1b0) from [&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8)</span><br><span class="line">[&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8) from [&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54)</span><br><span class="line">[&lt;8027dfa4&gt;] (snd_dma_free_pages+0xb4/0xc8) from [&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54)</span><br><span class="line">[&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54) from [&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c)</span><br><span class="line">[&lt;8027d4ac&gt;] (snd_pcm_lib_free_pages+0x2c/0x54) from [&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c)</span><br><span class="line">[&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c) from [&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4)</span><br><span class="line">[&lt;80292144&gt;] (aaci_pcm_hw_free+0x40/0x5c) from [&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4)</span><br><span class="line">[&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4) from [&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0)</span><br><span class="line">[&lt;80292180&gt;] (aaci_pcm_hw_params+0x20/0xd4) from [&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0)</span><br><span class="line">[&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0) from [&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4)</span><br><span class="line">[&lt;80276ce4&gt;] (snd_pcm_hw_params+0x114/0x3e0) from [&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4)</span><br><span class="line">[&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4) from [&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0)</span><br><span class="line">[&lt;80277984&gt;] (snd_pcm_common_ioctl1+0x5a0/0x10a4) from [&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0)</span><br><span class="line">[&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0) from [&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c)</span><br><span class="line">[&lt;80278990&gt;] (snd_pcm_playback_ioctl1+0x38/0x4c0) from [&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c)</span><br><span class="line">[&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c) from [&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0)</span><br><span class="line">[&lt;80278e84&gt;] (snd_pcm_kernel_ioctl+0x40/0x6c) from [&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0)</span><br><span class="line">[&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0) from [&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74)</span><br><span class="line">[&lt;80282730&gt;] (snd_pcm_oss_change_params+0x818/0xcc0) from [&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74)</span><br><span class="line">[&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74) from [&lt;80283230&gt;] (snd_pcm_oss_get_rate+0x10/0x28)</span><br><span class="line">[&lt;80283214&gt;] (snd_pcm_oss_get_active_substream+0x68/0x74) from [&lt;80283230&gt;] (snd_pcm_oss_get_rate+0x10/0x28)</span><br><span class="line">[&lt;80283230&gt;] (snd_pcm_oss_get_rate+0x10/0x28) from [&lt;80284658&gt;] (snd_pcm_oss_ioctl+0xbb8/0xd2c)</span><br><span class="line">[&lt;80283230&gt;] (snd_pcm_oss_get_rate+0x10/0x28) from [&lt;80284658&gt;] (snd_pcm_oss_ioctl+0xbb8/0xd2c)</span><br><span class="line">[&lt;80284658&gt;] (snd_pcm_oss_ioctl+0xbb8/0xd2c) from [&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0)</span><br><span class="line">[&lt;80284658&gt;] (snd_pcm_oss_ioctl+0xbb8/0xd2c) from [&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0)</span><br><span class="line">[&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0) from [&lt;800c7204&gt;] (sys_ioctl+0x38/0x60)</span><br><span class="line">[&lt;800c6c9c&gt;] (do_vfs_ioctl+0x80/0x5b0) from [&lt;800c7204&gt;] (sys_ioctl+0x38/0x60)</span><br><span class="line">[&lt;800c7204&gt;] (sys_ioctl+0x38/0x60) from [&lt;8000e2c0&gt;] (ret_fast_syscall+0x0/0x30)</span><br><span class="line">[&lt;800c7204&gt;] (sys_ioctl+0x38/0x60) from [&lt;8000e2c0&gt;] (ret_fast_syscall+0x0/0x30)</span><br></pre></td></tr></table></figure>



<h2 id="iconv"><a href="#iconv" class="headerlink" title="iconv"></a>iconv</h2><p><font color="red">后续移植</font></p>
<h3 id="iconv概述"><a href="#iconv概述" class="headerlink" title="iconv概述"></a>iconv概述</h3><p>iconv是字符编码转换库</p>
<h3 id="iconv应用"><a href="#iconv应用" class="headerlink" title="iconv应用"></a>iconv应用</h3><h2 id="FrameBuffer"><a href="#FrameBuffer" class="headerlink" title="FrameBuffer"></a>FrameBuffer</h2><p><font color="red">后续移植</font></p>
<h3 id="FrameBuffer概述"><a href="#FrameBuffer概述" class="headerlink" title="FrameBuffer概述"></a>FrameBuffer概述</h3><p><strong>framebuffer简介</strong></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241015225141191.png" alt="image-20241015225141191"></p>
<p><strong>FrameBuffer编程模型</strong></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241015225312473.png" alt="image-20241015225312473"></p>
<p><strong>对framebuffer设备操作</strong></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241015225538409.png" alt="image-20241015225538409"></p>
<p><strong>操作framebuffer步骤</strong></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20241015225711248.png" alt="image-20241015225711248"></p>
<p><strong>framebuffer信息结构</strong></p>
<h3 id="framebuffer实战"><a href="#framebuffer实战" class="headerlink" title="framebuffer实战"></a>framebuffer实战</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/08/csapp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/08/csapp%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/" class="post-title-link" itemprop="url">csapp学习笔记</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-08 08:00:00" itemprop="dateCreated datePublished" datetime="2024-09-08T08:00:00+08:00">2024-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-26 08:00:00" itemprop="dateModified" datetime="2024-09-26T08:00:00+08:00">2024-09-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E8%AE%A1%E7%AE%97%E6%9C%BA%E7%BB%84%E6%88%90%E5%8E%9F%E7%90%86/" itemprop="url" rel="index"><span itemprop="name">计算机组成原理</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>1.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>1 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="CSAPP"><a href="#CSAPP" class="headerlink" title="CSAPP"></a>CSAPP</h2><h3 id="第一章"><a href="#第一章" class="headerlink" title="第一章"></a>第一章</h3><p>程序运行流程：<br>首先我们按下.&#x2F;hello ，字符串从键盘被读取 shell会将读取到的字符串逐一加载到寄存器，处理器会把hello字符串放到内存中。（注意此处不可以DMA直接读取到内存，内存只是存储空间，不放在寄存器里面program count无法指向程序）按下回车键，指令结束，shell会通过一系列指令加载可执行文件hello。这些指令会将hello中的数据和指令从磁盘督导内存而不经过CPU，这既是DMA技术。当hello中的数据和指令到达内存时，处理器就开始执行指令。CPU会将hello world\n 这个字符串复制到寄存器文件，然后再从寄存器文件复制到显示设备。</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240701095309869.png" alt="image-20240701095309869"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240701095600280.png" alt="image-20240701095600280"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702105444786.png" alt="image-20240702105444786"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702111734630.png" alt="image-20240702111734630"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702105905118.png" alt="image-20240702105905118"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702110710375.png" alt="image-20240702110710375"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702111326538.png" alt="image-20240702111326538"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702111503634.png" alt="image-20240702111503634"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702111802383.png" alt="image-20240702111802383"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702111905488.png" alt="image-20240702111905488"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702112016418.png" alt="image-20240702112016418"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240702112105886.png" alt="image-20240702112105886"></p>
<h3 id="第二章-信息的表示和存储"><a href="#第二章-信息的表示和存储" class="headerlink" title="第二章 信息的表示和存储"></a>第二章 信息的表示和存储</h3><h4 id="2-1-信息存储"><a href="#2-1-信息存储" class="headerlink" title="2.1 信息存储"></a>2.1 信息存储</h4><p>gcc -m32 -o hello32 hello.c #编译32位程序<br>gcc -m64 -o hello64 hello.c #编译64位程序<br>if(a &amp;&amp; 5&#x2F;a) &#x2F;&#x2F;先判断a是否为0 如果是0，则不再执行后续</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240704100006629.png" alt="image-20240704100006629"><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240704100206456.png" alt="image-20240704100206456"></p>
<p>算术右移与逻辑右移不同之处：算术右移操作数最高位为1时，左端补1 逻辑右移直接补0<br>一般有符号数算术右移 无符号数逻辑右移</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240704100617873.png" alt="image-20240704100617873"></p>
<h4 id="2-2-整数的表示"><a href="#2-2-整数的表示" class="headerlink" title="2.2 整数的表示"></a>2.2 整数的表示</h4><p>二进制补码 <strong>补码是首位是1则为负，首位为0即是正数</strong></p>
<ul>
<li>正数的补码与原码相同。</li>
<li>负数的补码是对原码（符号位除外）按位取反后加1得到的。</li>
</ul>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716155215275.png" alt="image-20240716155215275"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716160847167.png" alt="image-20240716160847167"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716161547701.png" alt="image-20240716161547701"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716161623476.png" alt="image-20240716161033328"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716161706090.png" alt="image-20240716161706090"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716161738855.png" alt="image-20240716161738855"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716161431728.png" alt="image-20240716161431728"></p>
<h4 id="2-3-整数的运算-remain"><a href="#2-3-整数的运算-remain" class="headerlink" title="2.3 整数的运算-remain"></a>2.3 整数的运算-remain</h4><p>正溢出实际上是一种假溢出，因为没有舍弃位，而是最高位由0变为1，产生了负权重<br>负溢出是真正意义的溢出，最高位产生溢出，而被丢弃，使得负权重丢失，让结果变为正数</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716163831757.png" alt="image-20240716163831757"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716165402940.png" alt="image-20240716165402940"></p>
<p>加入偏置后再右移 偏置为（(1&lt;&lt;k )-1）接口得到向0舍入的结果</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716165824328.png" alt="image-20240716165824328"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716170116721.png" alt="image-20240716170116721"></p>
<h4 id="2-4-浮点数"><a href="#2-4-浮点数" class="headerlink" title="2.4 浮点数"></a>2.4 浮点数</h4><p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716175926183.png" alt="image-20240716175926183"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716175215470.png" alt="image-20240716175215470"></p>
<p>阶码（Exponent）</p>
<p>阶码用于表示浮点数中指数部分的值。它决定了尾数的小数点应该向左或向右移动多少位，从而表示出不同的数值范围。在IEEE 754标准中，阶码通常采用偏移（或称为偏置）的方式来表示，这是为了使得所有的指数都有一个正的表示，包括负数。偏移值通常是2<em>e</em>−1−1，其中<em>e</em>是阶码的位数。</p>
<p>例如，在一个单精度浮点数（32位）中，阶码占据了其中的8位（包括一个符号位），因此偏移值为27−1&#x3D;127。如果一个单精度浮点数的阶码字段为128（二进制为10000000），那么实际的指数值为128−127&#x3D;1，表示小数点向右移动1位。</p>
<p>尾数（Mantissa 或 Significand）</p>
<p>尾数（或称为有效数字）是浮点数中表示数值精度（或大小）的部分。它紧跟在阶码之后，包含了浮点数中除去隐含的整数位（在IEEE 754标准中，对于非零的规格化浮点数，尾数前会隐含一个1，这个1不会存储在尾数字段中）之外的所有位。尾数可以是整数也可以是分数，但在计算机中，它们通常以二进制形式存储。</p>
<p>在IEEE 754标准中，尾数部分还包括了一个隐含的二进制点，这意味着尾数实际上是一个二进制小数，而不仅仅是整数或二进制数的集合。这种设计允许浮点数以更高的精度来表示小数。</p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716180332384.png" alt="image-20240716180332384"></p>
<p><img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716180809606.png" alt="image-20240716180809606">   </p>
<p>浮点数结果不具有整数相关性<img src="https://adonkey.oss-cn-beijing.aliyuncs.com/picgo/image-20240716181450431.png" alt="image-20240716181450431"></p>
<h3 id="第三章-程序的机器级表示"><a href="#第三章-程序的机器级表示" class="headerlink" title="第三章 程序的机器级表示"></a>第三章 程序的机器级表示</h3>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/09/08/freetype%E7%A7%BB%E6%A4%8D/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/09/08/freetype%E7%A7%BB%E6%A4%8D/" class="post-title-link" itemprop="url">freetype移植</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-09-08 08:00:00" itemprop="dateCreated datePublished" datetime="2024-09-08T08:00:00+08:00">2024-09-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-26 08:00:00" itemprop="dateModified" datetime="2024-09-26T08:00:00+08:00">2024-09-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/QT/" itemprop="url" rel="index"><span itemprop="name">QT</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>8.4k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>8 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h3 id="freetype移植"><a href="#freetype移植" class="headerlink" title="freetype移植"></a>freetype移植</h3><h4 id="类型匹配"><a href="#类型匹配" class="headerlink" title="类型匹配"></a>类型匹配</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">CvScalar s = &#123;<span class="number">0</span>, <span class="number">255</span>, <span class="number">0</span>&#125;; <span class="comment">//!这里有一个类型不匹配问题：cv::Scalar 不能隐式转换为 CvScalar。</span></span><br><span class="line">text.<span class="built_in">putText</span>(img, msg, pos, s); <span class="comment">// 绘制文本</span></span><br></pre></td></tr></table></figure>
<h4 id="中文字体使用宽字符"><a href="#中文字体使用宽字符" class="headerlink" title="中文字体使用宽字符"></a>中文字体使用宽字符</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">const</span> <span class="type">wchar_t</span> *msg = <span class="string">L&quot;偏振图像&quot;</span>; <span class="comment">// 使用宽字符</span></span><br></pre></td></tr></table></figure>
<h4 id="CvxText"><a href="#CvxText" class="headerlink" title="CvxText"></a>CvxText</h4><ul>
<li>参考源码地址<a target="_blank" rel="noopener" href="https://bigbookplus.github.io/blog/2022-06-15-cvxtext-opencv45.html">OpenCV 4.X 使用CvxText在图片显示汉字 | Learning BigBook (bigbookplus.github.io)</a></li>
<li>注意linux引用opencv 使用&#x2F; 而在Windows使用\</li>
<li>这份源文件有问题，如下图，注意临时对象不能右值引用，Visual Studio中会将其延长生命周期 linux-g++编译不会优化编译<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">void</span> <span class="title">CvxText::putWChar</span><span class="params">(cv::Mat &amp;frame, <span class="type">wchar_t</span> wc, CvPoint &amp;pos, CvScalar color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// IplImage* img = NULL;</span></span><br><span class="line">    <span class="comment">// img = &amp;(cvIplImage(frame));</span></span><br><span class="line">    <span class="comment">//!临时对象非const不能右值引用</span></span><br><span class="line">    IplImage temp_img = <span class="built_in">cvIplImage</span>(frame);  <span class="comment">// 创建IplImage的副本</span></span><br><span class="line">    IplImage* img = &amp;temp_img;              <span class="comment">// 取得指针</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Makefile"><a href="#Makefile" class="headerlink" title="Makefile"></a>Makefile</h4><ul>
<li>只需要freetype2.pc </li>
<li>注意看系统中是否有freetype的动态库 避免多个库复用导致vim出现问题 我的Ubuntu使用的freetype动态链接库版本是libfreetype.so.6.17.1</li>
<li>之前在Makefile中必须要加上<code>LDFLAGS += -L/usr/lib/x86_64-linux-gnu/</code>这句话是因为在移植freetype时执行sudo make install所以将另一个版本的pc文件或者动态&#x2F;静态库安装在&#x2F;usr&#x2F;local&#x2F;lib中 删除即可</li>
</ul>
<h4 id="msyh-ttf"><a href="#msyh-ttf" class="headerlink" title="msyh.ttf"></a>msyh.ttf</h4><ul>
<li>微软雅黑字体msyh.ttf需放到运行目录下</li>
</ul>
<h4 id="CvxText-cpp"><a href="#CvxText-cpp" class="headerlink" title="CvxText.cpp"></a>CvxText.cpp</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;CvxText.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;wchar.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;assert.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;locale.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ctype.h&gt;</span> </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/core/core.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc/imgproc.hpp&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> cv;</span><br><span class="line"></span><br><span class="line">CvxText::<span class="built_in">CvxText</span>(<span class="type">const</span> <span class="type">char</span> *freeType)</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">assert</span>(freeType != <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ���ֿ��ļ�, ����һ������  </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (<span class="built_in">FT_Init_FreeType</span>(&amp;m_library)) <span class="keyword">throw</span>;</span><br><span class="line">	<span class="type">int</span> result = <span class="number">100</span>;</span><br><span class="line">	<span class="comment">//result = FT_New_Face(m_library, freeType, 0, &amp;m_face);</span></span><br><span class="line">	<span class="keyword">if</span> (result = <span class="built_in">FT_New_Face</span>(m_library, freeType, <span class="number">0</span>, &amp;m_face)) <span class="keyword">throw</span>;</span><br><span class="line">	</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ���������������  </span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">restoreFont</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ����C���Ե��ַ�������  </span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">setlocale</span>(LC_ALL, <span class="string">&quot;&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// �ͷ�FreeType��Դ  </span></span><br><span class="line"></span><br><span class="line">CvxText::~<span class="built_in">CvxText</span>()</span><br><span class="line">&#123;</span><br><span class="line">	<span class="built_in">FT_Done_Face</span>(m_face);</span><br><span class="line">	<span class="built_in">FT_Done_FreeType</span>(m_library);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// �����������:  </span></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"><span class="comment">// font         - ��������, Ŀǰ��֧��  </span></span><br><span class="line"><span class="comment">// size         - �����С/�հױ���/�������/��ת�Ƕ�  </span></span><br><span class="line"><span class="comment">// underline   - �»���  </span></span><br><span class="line"><span class="comment">// diaphaneity   - ͸����  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CvxText::getFont</span><span class="params">(<span class="type">int</span> *type, CvScalar *size, <span class="type">bool</span> *underline, <span class="type">float</span> *diaphaneity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (type) *type = m_fontType;</span><br><span class="line">	<span class="keyword">if</span> (size) *size = m_fontSize;</span><br><span class="line">	<span class="keyword">if</span> (underline) *underline = m_fontUnderline;</span><br><span class="line">	<span class="keyword">if</span> (diaphaneity) *diaphaneity = m_fontDiaphaneity;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CvxText::setFont</span><span class="params">(<span class="type">int</span> *type, CvScalar *size, <span class="type">bool</span> *underline, <span class="type">float</span> *diaphaneity)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// �����Ϸ��Լ��  </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (type)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">if</span> (type &gt;= <span class="number">0</span>) m_fontType = *type;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (size)</span><br><span class="line">	&#123;</span><br><span class="line">		m_fontSize.val[<span class="number">0</span>] = <span class="built_in">fabs</span>(size-&gt;val[<span class="number">0</span>]);</span><br><span class="line">		m_fontSize.val[<span class="number">1</span>] = <span class="built_in">fabs</span>(size-&gt;val[<span class="number">1</span>]);</span><br><span class="line">		m_fontSize.val[<span class="number">2</span>] = <span class="built_in">fabs</span>(size-&gt;val[<span class="number">2</span>]);</span><br><span class="line">		m_fontSize.val[<span class="number">3</span>] = <span class="built_in">fabs</span>(size-&gt;val[<span class="number">3</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (underline)</span><br><span class="line">	&#123;</span><br><span class="line">		m_fontUnderline = *underline;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (diaphaneity)</span><br><span class="line">	&#123;</span><br><span class="line">		m_fontDiaphaneity = *diaphaneity;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// �ָ�ԭʼ����������  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CvxText::restoreFont</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	m_fontType = <span class="number">0</span>;            <span class="comment">// ��������(��֧��)  </span></span><br><span class="line"></span><br><span class="line">	m_fontSize.val[<span class="number">0</span>] = <span class="number">40</span>;      <span class="comment">// �����С  </span></span><br><span class="line">	m_fontSize.val[<span class="number">1</span>] = <span class="number">0.5</span>;   <span class="comment">// �հ��ַ���С����  </span></span><br><span class="line">	m_fontSize.val[<span class="number">2</span>] = <span class="number">0.1</span>;   <span class="comment">// �����С����  </span></span><br><span class="line">	m_fontSize.val[<span class="number">3</span>] = <span class="number">0</span>;      <span class="comment">// ��ת�Ƕ�(��֧��)  </span></span><br><span class="line"></span><br><span class="line">	m_fontUnderline = <span class="literal">false</span>;   <span class="comment">// �»���(��֧��)  </span></span><br><span class="line"></span><br><span class="line">	m_fontDiaphaneity = <span class="number">1.0</span>;   <span class="comment">// ɫ�ʱ���(�ɲ���͸��Ч��)  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// �����ַ���С  </span></span><br><span class="line"></span><br><span class="line">	<span class="built_in">FT_Set_Pixel_Sizes</span>(m_face, (<span class="type">int</span>)m_fontSize.val[<span class="number">0</span>], <span class="number">0</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// �������(��ɫĬ��Ϊ��ɫ)  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CvxText::putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">char</span>    *text, CvPoint pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//return putText(frame, text, pos, CV_RGB(255, 255, 255));</span></span><br><span class="line">	CvScalar s = &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">putText</span>(frame, text, pos, s);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CvxText::putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">wchar_t</span> *text, CvPoint pos)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">//return putText(frame, text, pos, CV_RGB(255, 255, 255));</span></span><br><span class="line">	CvScalar s = &#123;<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>&#125;;</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">putText</span>(frame, text, pos, s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CvxText::putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">char</span>    *text, CvPoint pos, CvScalar color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (frame.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">if</span> (text == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; text[i] != <span class="string">&#x27;\0&#x27;</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="type">wchar_t</span> wc = text[i];</span><br><span class="line"></span><br><span class="line">		<span class="comment">// ����˫�ֽڷ���  </span></span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (!<span class="built_in">isascii</span>(wc)) <span class="built_in">mbtowc</span>(&amp;wc, &amp;text[i++], <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">		<span class="comment">// �����ǰ���ַ�  </span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">putWChar</span>(frame, wc, pos, color);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">CvxText::putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">wchar_t</span> *text, CvPoint pos, CvScalar color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (frame.<span class="built_in">empty</span>()) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">if</span> (text == <span class="literal">NULL</span>) <span class="keyword">return</span> <span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> i;</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; text[i] != <span class="string">&#x27;\0&#x27;</span>; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="comment">// �����ǰ���ַ�  </span></span><br><span class="line"></span><br><span class="line">		<span class="built_in">putWChar</span>(frame, text[i], pos, color);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// �����ǰ�ַ�, ����m_posλ��  </span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">CvxText::putWChar</span><span class="params">(cv::Mat &amp;frame, <span class="type">wchar_t</span> wc, CvPoint &amp;pos, CvScalar color)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">	<span class="comment">// IplImage* img = NULL;</span></span><br><span class="line">	<span class="comment">// img = &amp;(cvIplImage(frame));</span></span><br><span class="line">	<span class="comment">//!临时对象非const不能右值引用</span></span><br><span class="line">	IplImage temp_img = <span class="built_in">cvIplImage</span>(frame);  <span class="comment">// 创建IplImage的副本</span></span><br><span class="line">    IplImage* img = &amp;temp_img;              <span class="comment">// 取得指针</span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// ����unicode��������Ķ�ֵλͼ  </span></span><br><span class="line"></span><br><span class="line">	FT_UInt glyph_index = <span class="built_in">FT_Get_Char_Index</span>(m_face, wc);</span><br><span class="line">	<span class="built_in">FT_Load_Glyph</span>(m_face, glyph_index, FT_LOAD_DEFAULT);</span><br><span class="line">	<span class="built_in">FT_Render_Glyph</span>(m_face-&gt;glyph, FT_RENDER_MODE_MONO);</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">	FT_GlyphSlot slot = m_face-&gt;glyph;</span><br><span class="line"></span><br><span class="line">	<span class="comment">// ������  </span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> rows = slot-&gt;bitmap.rows;</span><br><span class="line">	<span class="type">int</span> cols = slot-&gt;bitmap.width;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//  </span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">for</span> (<span class="type">int</span> i = <span class="number">0</span>; i &lt; rows; ++i)</span><br><span class="line">	&#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="type">int</span> j = <span class="number">0</span>; j &lt; cols; ++j)</span><br><span class="line">		&#123;</span><br><span class="line">			<span class="type">int</span> off = ((img-&gt;origin == <span class="number">0</span>) ? i : (rows - <span class="number">1</span> - i))</span><br><span class="line">				* slot-&gt;bitmap.pitch + j / <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">			<span class="keyword">if</span> (slot-&gt;bitmap.buffer[off] &amp; (<span class="number">0xC0</span> &gt;&gt; (j % <span class="number">8</span>)))</span><br><span class="line">			&#123;</span><br><span class="line">				<span class="type">int</span> r = (img-&gt;origin == <span class="number">0</span>) ? pos.y - (rows - <span class="number">1</span> - i) : pos.y + i;;</span><br><span class="line">				<span class="type">int</span> c = pos.x + j;</span><br><span class="line"></span><br><span class="line">				<span class="keyword">if</span> (r &gt;= <span class="number">0</span> &amp;&amp; r &lt; img-&gt;height</span><br><span class="line">					&amp;&amp; c &gt;= <span class="number">0</span> &amp;&amp; c &lt; img-&gt;width)</span><br><span class="line">				&#123;</span><br><span class="line">					CvScalar scalar = <span class="built_in">cvGet2D</span>(img, r, c);</span><br><span class="line"></span><br><span class="line">					<span class="comment">// ����ɫ���ں�  </span></span><br><span class="line"></span><br><span class="line">					<span class="type">float</span> p = m_fontDiaphaneity;</span><br><span class="line">					<span class="keyword">for</span> (<span class="type">int</span> k = <span class="number">0</span>; k &lt; <span class="number">4</span>; ++k)</span><br><span class="line">					&#123;</span><br><span class="line">						scalar.val[k] = scalar.val[k] * (<span class="number">1</span> - p) + color.val[k] * p;</span><br><span class="line">					&#125;</span><br><span class="line"></span><br><span class="line">					<span class="built_in">cvSet2D</span>(img, r, c, scalar);</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="comment">// end for  </span></span><br><span class="line">	&#125; <span class="comment">// end for  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// �޸���һ���ֵ����λ��  </span></span><br><span class="line"></span><br><span class="line">	<span class="type">double</span> space = m_fontSize.val[<span class="number">0</span>] * m_fontSize.val[<span class="number">1</span>];</span><br><span class="line">	<span class="type">double</span> sep = m_fontSize.val[<span class="number">0</span>] * m_fontSize.val[<span class="number">2</span>];</span><br><span class="line"></span><br><span class="line">	pos.x += (<span class="type">int</span>)((cols ? cols : space) + sep);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<h4 id="CvxText-h"><a href="#CvxText-h" class="headerlink" title="CvxText.h"></a>CvxText.h</h4><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">ifndef</span> CVX_TEXT_H</span></span><br><span class="line"><span class="meta">#<span class="keyword">define</span> CVX_TEXT_H</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;ft2build.h&gt;</span>  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> FT_FREETYPE_H  </span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/core/core.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/core/core_c.h&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/highgui/highgui.hpp&quot;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&quot;opencv2/imgproc/imgproc.hpp&quot;</span></span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">CvxText</span></span><br><span class="line">&#123;</span><br><span class="line">	<span class="comment">// ��ֹcopy  </span></span><br><span class="line">	CvxText&amp; <span class="keyword">operator</span>=(<span class="type">const</span> CvxText&amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">	<span class="built_in">CvxText</span>(<span class="type">const</span> <span class="type">char</span> *freeType);</span><br><span class="line">	<span class="keyword">virtual</span> ~<span class="built_in">CvxText</span>();</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* ��ȡ���塣Ŀǰ��Щ�����в�֧�֡�</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \param font        ��������, Ŀǰ��֧��</span></span><br><span class="line"><span class="comment">	* \param size        �����С/�հױ���/�������/��ת�Ƕ�</span></span><br><span class="line"><span class="comment">	* \param underline   �»���</span></span><br><span class="line"><span class="comment">	* \param diaphaneity ͸����</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \sa setFont, restoreFont</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">getFont</span><span class="params">(<span class="type">int</span> *type,</span></span></span><br><span class="line"><span class="params"><span class="function">		CvScalar *size = <span class="literal">NULL</span>, <span class="type">bool</span> *underline = <span class="literal">NULL</span>, <span class="type">float</span> *diaphaneity = <span class="literal">NULL</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* �������塣Ŀǰ��Щ�����в�֧�֡�</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \param font        ��������, Ŀǰ��֧��</span></span><br><span class="line"><span class="comment">	* \param size        �����С/�հױ���/�������/��ת�Ƕ�</span></span><br><span class="line"><span class="comment">	* \param underline   �»���</span></span><br><span class="line"><span class="comment">	* \param diaphaneity ͸����</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \sa getFont, restoreFont</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">setFont</span><span class="params">(<span class="type">int</span> *type,</span></span></span><br><span class="line"><span class="params"><span class="function">		CvScalar *size = <span class="literal">NULL</span>, <span class="type">bool</span> *underline = <span class="literal">NULL</span>, <span class="type">float</span> *diaphaneity = <span class="literal">NULL</span>)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* �ָ�ԭʼ���������á�</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \sa getFont, setFont</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">restoreFont</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* �������(��ɫĬ��Ϊ��ɫ)����������������ַ���ֹͣ��</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \param img  �����Ӱ��</span></span><br><span class="line"><span class="comment">	* \param text �ı�����</span></span><br><span class="line"><span class="comment">	* \param pos  �ı�λ��</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \return ���سɹ�������ַ����ȣ�ʧ�ܷ���-1��</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">char</span>    *text, CvPoint pos)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* �������(��ɫĬ��Ϊ��ɫ)����������������ַ���ֹͣ��</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \param img  �����Ӱ��</span></span><br><span class="line"><span class="comment">	* \param text �ı�����</span></span><br><span class="line"><span class="comment">	* \param pos  �ı�λ��</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \return ���سɹ�������ַ����ȣ�ʧ�ܷ���-1��</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">wchar_t</span> *text, CvPoint pos)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* ������֡���������������ַ���ֹͣ��</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \param img   �����Ӱ��</span></span><br><span class="line"><span class="comment">	* \param text  �ı�����</span></span><br><span class="line"><span class="comment">	* \param pos   �ı�λ��</span></span><br><span class="line"><span class="comment">	* \param color �ı���ɫ</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \return ���سɹ�������ַ����ȣ�ʧ�ܷ���-1��</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">char</span>    *text, CvPoint pos, CvScalar color)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/**</span></span><br><span class="line"><span class="comment">	* ������֡���������������ַ���ֹͣ��</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \param img   �����Ӱ��</span></span><br><span class="line"><span class="comment">	* \param text  �ı�����</span></span><br><span class="line"><span class="comment">	* \param pos   �ı�λ��</span></span><br><span class="line"><span class="comment">	* \param color �ı���ɫ</span></span><br><span class="line"><span class="comment">	*</span></span><br><span class="line"><span class="comment">	* \return ���سɹ�������ַ����ȣ�ʧ�ܷ���-1��</span></span><br><span class="line"><span class="comment">	*/</span></span><br><span class="line">	<span class="function"><span class="type">int</span> <span class="title">putText</span><span class="params">(cv::Mat &amp;frame, <span class="type">const</span> <span class="type">wchar_t</span> *text, CvPoint pos, CvScalar color)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	<span class="comment">// �����ǰ�ַ�, ����m_posλ��  </span></span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="type">void</span> <span class="title">putWChar</span><span class="params">(cv::Mat &amp;frame, <span class="type">wchar_t</span> wc, CvPoint &amp;pos, CvScalar color)</span></span>;</span><br><span class="line"></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line"></span><br><span class="line">	FT_Library   m_library;   <span class="comment">// �ֿ�  </span></span><br><span class="line">	FT_Face      m_face;      <span class="comment">// ����  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line">	<span class="comment">//================================================================  </span></span><br><span class="line"></span><br><span class="line">	<span class="comment">// Ĭ�ϵ������������  </span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span>         m_fontType;</span><br><span class="line">	CvScalar   m_fontSize;</span><br><span class="line">	<span class="type">bool</span>      m_fontUnderline;</span><br><span class="line">	<span class="type">float</span>      m_fontDiaphaneity;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/08/28/cjson%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/08/28/cjson%E6%BA%90%E7%A0%81%E5%AD%A6%E4%B9%A0/" class="post-title-link" itemprop="url">cjson源码学习</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-08-28 08:00:00" itemprop="dateCreated datePublished" datetime="2024-08-28T08:00:00+08:00">2024-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-26 08:00:00" itemprop="dateModified" datetime="2024-09-26T08:00:00+08:00">2024-09-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">C语言</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>2.3k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>2 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="cjson源码学习"><a href="#cjson源码学习" class="headerlink" title="cjson源码学习"></a>cjson源码学习</h1><p>本篇博客用于记录学习cjson源码历程</p>
<h2 id="用途"><a href="#用途" class="headerlink" title="用途"></a>用途</h2><p>cjson用于生成&#x2F;解析json格式数据的轻量级源码  </p>
<h2 id="代码分析"><a href="#代码分析" class="headerlink" title="代码分析"></a>代码分析</h2><h3 id="cjson结构体"><a href="#cjson结构体" class="headerlink" title="cjson结构体"></a>cjson结构体</h3><p>对于cjson结构体的数据结构类似于树的的结构对于array&#x2F;object类型</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">cJSON</span> &#123;</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cJSON</span> *<span class="title">next</span>,*<span class="title">prev</span>;</span>	<span class="comment">/* next/prev allow you to walk array/object chains. Alternatively, use GetArraySize/GetArrayItem/GetObjectItem */</span></span><br><span class="line">	<span class="class"><span class="keyword">struct</span> <span class="title">cJSON</span> *<span class="title">child</span>;</span>		<span class="comment">/* An array or object item will have a child pointer pointing to a chain of the items in the array/object. */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">int</span> type;					<span class="comment">/* The type of the item, as above. */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> *valuestring;			<span class="comment">/* The item&#x27;s string, if type==cJSON_String */</span></span><br><span class="line">	<span class="type">int</span> valueint;				<span class="comment">/* The item&#x27;s number, if type==cJSON_Number */</span></span><br><span class="line">	<span class="type">double</span> valuedouble;			<span class="comment">/* The item&#x27;s number, if type==cJSON_Number */</span></span><br><span class="line"></span><br><span class="line">	<span class="type">char</span> *<span class="built_in">string</span>;				<span class="comment">/* The item&#x27;s name string, if this item is the child of, or is in the list of subitems of an object. */</span></span><br><span class="line">&#125; cJSON;</span><br></pre></td></tr></table></figure>

<h3 id="json格式"><a href="#json格式" class="headerlink" title="json格式"></a>json格式</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="title function_">root</span> (cJSON_Object)</span><br><span class="line">├── <span class="string">&quot;name&quot;</span> : <span class="string">&quot;Jack (\&quot;Bee\&quot;) Nimble&quot;</span> (cJSON_String)</span><br><span class="line">└── <span class="string">&quot;format&quot;</span> : <span class="title function_">fmt</span> (cJSON_Object)</span><br><span class="line">    ├── <span class="string">&quot;type&quot;</span> : <span class="string">&quot;rect&quot;</span> (cJSON_String)</span><br><span class="line">    ├── <span class="string">&quot;width&quot;</span> : <span class="number">1920</span> (cJSON_Number)</span><br><span class="line">    ├── <span class="string">&quot;height&quot;</span> : <span class="number">1080</span> (cJSON_Number)</span><br><span class="line">    ├── <span class="string">&quot;interlace&quot;</span> : <span class="title function_">false</span> (cJSON_False)</span><br><span class="line">    └── <span class="string">&quot;frame rate&quot;</span> : <span class="number">24</span> (cJSON_Number)</span><br></pre></td></tr></table></figure>

<h3 id="数组解析"><a href="#数组解析" class="headerlink" title="数组解析"></a>数组解析</h3><p>对于数组格式的json数据，如下代码展示如何通过child, next, prev指针构建链表进行解析。</p>
<p>这里新建了一个item，并赋值给child，先检测第一个数据并将其放在数组第一个位置上，这样保证链表头即是数组首个元素。</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// +----------------+     +----------------+     +----------------+</span></span><br><span class="line"><span class="comment">// |  cJSON object  | --&gt; |  cJSON object  | --&gt; |  cJSON object  |</span></span><br><span class="line"><span class="comment">// | (array head)   |     | (next element) |     | (next element) |</span></span><br><span class="line"><span class="comment">// +----------------+     +----------------+     +----------------+</span></span><br><span class="line"><span class="comment">//   item-&gt;child           child-&gt;next              child-&gt;next</span></span><br><span class="line"><span class="comment">//    /    |          \      /    |          \         |</span></span><br><span class="line"><span class="comment">//    ...   ...        ...   ...   ...        ...   ...</span></span><br><span class="line"><span class="comment">// /* Build an array from input text. */</span></span><br><span class="line"><span class="type">static</span> <span class="type">const</span> <span class="type">char</span> *<span class="title function_">parse_array</span><span class="params">(cJSON *item,<span class="type">const</span> <span class="type">char</span> *value)</span></span><br><span class="line">&#123;</span><br><span class="line">	cJSON *child;</span><br><span class="line">	<span class="keyword">if</span> (*value!=<span class="string">&#x27;[&#x27;</span>)	&#123;ep=value;<span class="keyword">return</span> <span class="number">0</span>;&#125;	<span class="comment">/* not an array! */</span></span><br><span class="line"></span><br><span class="line">	item-&gt;type=cJSON_Array;</span><br><span class="line">	value=skip(value+<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">if</span> (*value==<span class="string">&#x27;]&#x27;</span>) <span class="keyword">return</span> value+<span class="number">1</span>;	<span class="comment">/* empty array. */</span></span><br><span class="line"></span><br><span class="line">	item-&gt;child=child=cJSON_New_Item();</span><br><span class="line">	<span class="keyword">if</span> (!item-&gt;child) <span class="keyword">return</span> <span class="number">0</span>;		 <span class="comment">/* memory fail */</span></span><br><span class="line">	value=skip(parse_value(child,skip(value)));	<span class="comment">/* skip any spacing, get the value. */</span></span><br><span class="line">	<span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> (*value==<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">	&#123;</span><br><span class="line">		cJSON *new_item;</span><br><span class="line">		<span class="keyword">if</span> (!(new_item=cJSON_New_Item())) <span class="keyword">return</span> <span class="number">0</span>; 	<span class="comment">/* memory fail */</span></span><br><span class="line">		child-&gt;next=new_item;new_item-&gt;prev=child;child=new_item;</span><br><span class="line">		value=skip(parse_value(child,skip(value+<span class="number">1</span>)));</span><br><span class="line">		<span class="keyword">if</span> (!value) <span class="keyword">return</span> <span class="number">0</span>;	<span class="comment">/* memory fail */</span></span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">if</span> (*value==<span class="string">&#x27;]&#x27;</span>) <span class="keyword">return</span> value+<span class="number">1</span>;	<span class="comment">/* end of array */</span></span><br><span class="line">	ep=value;<span class="keyword">return</span> <span class="number">0</span>;	<span class="comment">/* malformed. */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/08/28/socket%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="ADonkey">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="凌云苑">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2024/08/28/socket%E7%BD%91%E7%BB%9C%E7%BC%96%E7%A8%8B/" class="post-title-link" itemprop="url">socket网络编程</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2024-08-28 08:00:00" itemprop="dateCreated datePublished" datetime="2024-08-28T08:00:00+08:00">2024-08-28</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2024-09-26 08:00:00" itemprop="dateModified" datetime="2024-09-26T08:00:00+08:00">2024-09-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/C/" itemprop="url" rel="index"><span itemprop="name">C++</span></a>
                </span>
            </span>

          <br>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
                <span class="post-meta-item-text">本文字数：</span>
              <span>4.2k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
                <span class="post-meta-item-text">阅读时长 &asymp;</span>
              <span>4 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h2 id="day01"><a href="#day01" class="headerlink" title="day01"></a>day01</h2><h3 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>在使用 accept 和 connect 之前，需要确保套接字已经正确创建并配置（例如，对于 accept，需要先绑定（bind）和监听（listen）套接字；对于 connect，需要先创建套接字并指定服务器的地址）。</li>
</ul>
<h3 id="bzero"><a href="#bzero" class="headerlink" title="bzero"></a>bzero</h3><ul>
<li>可用于初始化结构体 入口参数是addr和size</li>
</ul>
<h3 id="socklen-t"><a href="#socklen-t" class="headerlink" title="socklen_t"></a>socklen_t</h3><ul>
<li>用于表示套接字地址结构的长度</li>
<li>传递地址长度：在调用如 bind、connect、accept、getsockname、getpeername 等函数时，socklen_t 用于指定套接字地址结构的长度，或者用于接收函数返回的实际长度。</li>
<li>确保类型安全：由于历史原因，一些旧的网络函数可能期望地址长度参数是一个特定类型的指针（如 int *），而不是 socklen_t *。使用 socklen_t 可以帮助确保类型的正确性和兼容性。</li>
<li>避免溢出：由于 socklen_t 是无符号类型，它可以防止地址长度的溢出，这在处理来自不受信任来源的数据时尤其重要。</li>
</ul>
<h3 id="bind函数原型"><a href="#bind函数原型" class="headerlink" title="bind函数原型"></a>bind函数原型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">bind</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr *addr, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>sockfd：套接字文件描述符，这个套接字应该是之前已经创建的。</li>
<li>addr：指向 sockaddr 结构的指针，该结构包含了套接字要绑定的地址信息。对于 IPv4，这通常是 struct sockaddr_in 结构；对于 IPv6，则是 struct sockaddr_in6 结构。</li>
<li>addrlen：addr 指向的地址结构的大小。</li>
</ul>
<p>返回值：</p>
<ul>
<li>成功时，bind 函数返回 0。</li>
<li>失败时，返回 -1 并设置全局变量 errno 以指示错误原因。</li>
</ul>
<h3 id="listen函数原型"><a href="#listen函数原型" class="headerlink" title="listen函数原型"></a>listen函数原型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">listen</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">int</span> backlog)</span></span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>sockfd：套接字文件描述符，这个套接字应该是之前已经创建并且绑定到一个地址上的。</li>
<li>backlog：这个参数指定了内核应该为相应套接字排队的最大连接个数。这个数值不能超过系统特定的上限，通常在 &#x2F;proc&#x2F;sys&#x2F;net&#x2F;core&#x2F;somaxconn 文件中定义。</li>
</ul>
<p>返回值：</p>
<ul>
<li>成功时，listen 函数返回 0。</li>
<li>失败时，返回 -1 并设置全局变量 errno 以指示错误原因。</li>
</ul>
<h3 id="accept函数原型"><a href="#accept函数原型" class="headerlink" title="accept函数原型"></a>accept函数原型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">accept</span><span class="params">(<span class="type">int</span> sockfd, <span class="keyword">struct</span> sockaddr* addr, <span class="type">socklen_t</span>* addrlen)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>sockfd：监听套接字的文件描述符。</li>
<li>addr：（可选）指向 sockaddr 结构的指针，用于存储连接客户端的地址信息。如果不需要客户端地址，可以设置为 NULL。</li>
<li>addrlen：（可选）指向 socklen_t 类型变量的指针，该变量在调用 accept 时应该包含 addr 指向的缓冲区的大小。accept 成功返回后，该变量会包含实际客户端地址的大小。如果不需要客户端地址，可以设置为 NULL。</li>
<li>accept函数会阻塞当前程序，直至有一个客户端socket被接受程序才继续往下进行</li>
</ul>
<h3 id="connect函数原型"><a href="#connect函数原型" class="headerlink" title="connect函数原型"></a>connect函数原型</h3><figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">connect</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="keyword">struct</span> sockaddr* addr, <span class="type">socklen_t</span> addrlen)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>sockfd：客户端的套接字文件描述符。</li>
<li>addr：指向 sockaddr 结构的指针，该结构包含了服务器端套接字的地址信息。</li>
<li>addrlen：addr 指向的 sockaddr 结构的大小。</li>
<li>connect函数也是阻塞调用 连接成功&#x2F;失败&#x2F;超时</li>
</ul>
<p>返回值：</p>
<ul>
<li>accept 和 connect 函数在成功时返回非负值。</li>
<li>accept 返回一个新的文件描述符，用于与客户端通信的已连接套接字。</li>
<li>connect 返回 0 表示连接成功。</li>
<li>在失败时，这两个函数都会返回 -1，并设置全局变量 errno 以指示错误的具体原因。</li>
</ul>
<h2 id="day02"><a href="#day02" class="headerlink" title="day02"></a>day02</h2><h3 id="注意事项-1"><a href="#注意事项-1" class="headerlink" title="注意事项"></a>注意事项</h3><ul>
<li>printf输出到屏幕记得加\n 否则会暂存在缓冲区</li>
<li>inet_ntop 和 inet_pton 函数是线程安全的。</li>
<li>read 和 write 函数通常用于文件 I&#x2F;O，但也可以用于套接字 I&#x2F;O，尤其是在使用 Unix 域套接字时。<br>recv send函数专门用于网络套接字，它提供了一些特定于网络操作的标志，如 MSG_DONTWAIT 来执行非阻塞接收。</li>
</ul>
<h3 id="size-t"><a href="#size-t" class="headerlink" title="size_t"></a>size_t</h3><ul>
<li>size_t 是 C 语言标准库中定义的一个数据类型，它是一个无符号整数类型，通常用于表示对象的大小或数组中的元素数量。在内存分配、数组索引和其他需要表示内存大小或对象数量的上下文中，size_t 是一个常用的类型。它的定义通常在头文件 &lt;stddef.h&gt; 或 &lt;sys&#x2F;types.h&gt; 中。</li>
<li>可用于内存分配，数组大小，字符串长度，I&#x2F;O操作<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//内存操作</span></span><br><span class="line"><span class="type">size_t</span> num_bytes = <span class="number">1024</span>;</span><br><span class="line"><span class="type">void</span>* buf = <span class="built_in">malloc</span>(num_types)</span><br><span class="line"><span class="comment">//I/O操作</span></span><br><span class="line"><span class="type">size_t</span> bytes_to_read = <span class="number">512</span>;</span><br><span class="line"><span class="type">ssize_t</span> bytes_read = <span class="built_in">read</span>(file_descriptor, buffer, bytes_to_read);</span><br></pre></td></tr></table></figure></li>
</ul>
<h3 id="ssize-t"><a href="#ssize-t" class="headerlink" title="ssize_t"></a>ssize_t</h3><p>参数说明：</p>
<ul>
<li><p>ssize_t 通常在 &lt;sys&#x2F;types.h&gt; 头文件中定义</p>
</li>
<li><p>文件读写：如 read 和 write 系统调用，它们返回从文件中读取或写入文件的字节数，或者在出错时返回 -1。</p>
</li>
<li><p>字符串和内存操作：如 strlen 函数，它返回字符串的长度，使用 ssize_t 类型可以确保即使是非常长的字符串也能正确返回其长度。</p>
</li>
<li><p>网络编程：如 send 和 recv 函数，它们返回成功发送或接收的字节数，或者在出错时返回 -1。</p>
</li>
</ul>
<p>ssize_t和size_t区别：</p>
<p>1.有符号与无符号：</p>
<ul>
<li>size_t 是一个无符号整数类型，用于表示对象的大小或者数组中元素的数量。由于它不能表示负值，所以它只能用于表示非负的内存大小或计数。</li>
<li>ssize_t 是一个有符号整数类型，通常用于表示可以失败的系统调用的返回值，比如文件的读写操作。它可以表示负值，用于表示错误或者特定的状态。</li>
</ul>
<p>2.用途：</p>
<ul>
<li>size_t 通常用于内存分配（如 malloc、calloc 等函数的返回值），数组索引，以及任何需要表示大小或计数的上下文。</li>
<li>ssize_t 通常用于系统调用和库函数的返回值，如 read、write、send、recv 等，这些函数可能会失败并返回错误码（负值）。</li>
</ul>
<h3 id="read"><a href="#read" class="headerlink" title="read"></a>read</h3><p>read函数用于从文件描述符读取数据，它也可以用于从套接字读取数据。阻塞函数，直到有数据可读</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">read</span><span class="params">(<span class="type">int</span> fd, <span class="type">void</span>* buf, <span class="type">size_t</span> count)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>fd：文件描述符，可以是任何类型的文件、设备或套接字。</li>
<li>buf：指向缓冲区的指针，用于存储从文件描述符读取的数据。</li>
<li>count：要读取的最大字节数。<br>返回值：</li>
<li>read 成功时返回读取的字节数，出错时返回 -1。</li>
<li>如果到达文件或套接字的末尾（EOF），read 函数返回 0</li>
</ul>
<h3 id="write"><a href="#write" class="headerlink" title="write"></a>write</h3><p>write 函数用于将数据写入文件描述符，它也可以用于将数据发送到套接字。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">recv</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>fd：文件描述符，可以是任何类型的文件、设备或套接字。</li>
<li>buf：指向缓冲区的指针，包含要写入文件描述符的数据。</li>
<li>count：要写入的最大字节数。<br>返回值：</li>
<li>write 成功时返回写入的字节数，出错时返回 -1。</li>
</ul>
<h3 id="recv"><a href="#recv" class="headerlink" title="recv"></a>recv</h3><p>recv 函数是 BSD 套接字 API 的一部分，专门用于从套接字接收数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">recv</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">void</span> *buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>sockfd：套接字文件描述符。</li>
<li>buf：指向缓冲区的指针，用于存储从套接字接收的数据。</li>
<li>len：要接收的最大字节数。</li>
<li>flags：指定接收操作的行为，通常设置为 0。可以设置 MSG_OOB 来接收带外数据，MSG_PEEK 来窥视数据但不从队列中移除，MSG_WAITALL 来等待所有数据到达等。<br>返回值：</li>
<li>recv 成功时返回读取的字节数，出错时返回 -1。</li>
</ul>
<h3 id="send"><a href="#send" class="headerlink" title="send"></a>send</h3><p>send 函数用于向与套接字相关联的对等点发送数据。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">ssize_t</span> <span class="title">send</span><span class="params">(<span class="type">int</span> sockfd, <span class="type">const</span> <span class="type">void</span>* buf, <span class="type">size_t</span> len, <span class="type">int</span> flags)</span></span></span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>sockfd：套接字文件描述符。</li>
<li>buf：指向要发送数据的缓冲区的指针。</li>
<li>len：要发送的数据的长度。</li>
<li>flags：指定发送操作的行为，通常设置为 0。</li>
</ul>
<p>返回值：</p>
<ul>
<li>send 成功时返回发送的字节数，出错时返回 -1。</li>
</ul>
<h3 id="inet-ntop"><a href="#inet-ntop" class="headerlink" title="inet_ntop"></a>inet_ntop</h3><p>inet_ntop 函数用于将网络地址从二进制形式转换为文本形式的 IP 地址。</p>
<ul>
<li>n 代表 “number”，这里指的是网络地址的数值形式，通常是二进制形式的网络地址。</li>
<li>p 代表 “presentation”，这里指的是网络地址的表示形式，即人类可读的格式，如 IPv4 或 IPv6 的点分十进制表示。<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">const</span> <span class="type">char</span>* <span class="title">inet_ntop</span><span class="params">(<span class="type">int</span> af, <span class="type">const</span> <span class="type">void</span>* src, <span class="type">char</span>* dst, <span class="type">socklen_t</span> size)</span></span>;</span><br></pre></td></tr></table></figure>
参数说明：</li>
<li>af：地址族，例如 AF_INET 或 AF_INET6。</li>
<li>src：指向二进制网络地址的指针。</li>
<li>dst：指向用于存储转换后的文本地址的缓冲区的指针。</li>
<li>size：dst 缓冲区的大小。</li>
</ul>
<p>返回值：</p>
<ul>
<li>inet_ntop 返回一个指向转换后的文本地址的指针，或者在出错时返回 NULL。</li>
</ul>
<h3 id="inet-pton"><a href="#inet-pton" class="headerlink" title="inet_pton"></a>inet_pton</h3><p>inet_pton 函数用于将文本形式的 IP 地址转换为二进制形式的网络地址。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;arpa/inet.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">inet_pton</span><span class="params">(<span class="type">int</span> af, <span class="type">const</span> <span class="type">char</span>* src, <span class="type">void</span>* dst)</span></span>;</span><br></pre></td></tr></table></figure>
<p>参数说明：</p>
<ul>
<li>af：地址族，例如 AF_INET 或 AF_INET6。</li>
<li>src：指向文本形式的 IP 地址字符串的指针。</li>
<li>dst：指向用于存储转换后的二进制网络地址的缓冲区的指针。</li>
</ul>
<p>返回值：</p>
<ul>
<li>inet_pton 成功时返回 1，出错时返回 -1，如果输入地址无效则返回 0。</li>
</ul>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">ADonkey</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">14</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">16</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">ADonkey</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">71k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">1:04</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://mist.theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Mist</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/muse.js"></script>


<script src="/js/next-boot.js"></script>




  















  

  

</body>
</html>
